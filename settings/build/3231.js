"use strict";(globalThis.webpackChunkcomplianz_gdpr=globalThis.webpackChunkcomplianz_gdpr||[]).push([[3231,2640],{73231:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});var r=a(69307),s=a(65736),l=a(82640);const n=(0,a(99196).memo)((()=>{const e=10,[t,n]=(0,r.useState)({}),[o,c]=(0,r.useState)(!1),[d,i]=(0,r.useState)("ID"),[p,g]=(0,r.useState)("DESC"),[m,u]=(0,r.useState)(!1),[h,_]=(0,r.useState)(null),{records:f,searchValue:b,setSearchValue:z,deleteRecords:D,recordsLoaded:E,fetchData:v,resolveRecords:y,totalRecords:I,fetching:S}=(0,l.default)(),[k,C]=(0,r.useState)(""),[P,R]=(0,r.useState)([]),[x,N]=(0,r.useState)(null);(0,r.useEffect)((()=>{a.e(44).then(a.bind(a,90044)).then((e=>{let{default:t}=e;N((()=>t))}))}),[]),(0,r.useEffect)((()=>{E||v(e,1,d,p)}),[E]);const w=[{name:(0,r.createElement)("input",{type:"checkbox",className:o?"indeterminate":"",checked:m,onChange:a=>(a=>{if(a.target.checked){u(!0);let a=t.currentPage?t.currentPage:1,r=f.slice((a-1)*e,a*e);R(r.map((e=>e.ID)))}else u(!1),R([]);c(!1)})(a)}),selector:e=>e.selectControl,orderId:"select"},{name:(0,s.__)("User ID","complianz-gdpr"),selector:e=>e.ID,sortable:!0,orderId:"ID"},{name:(0,s.__)("Name","complianz-gdpr"),selector:e=>e.name,sortable:!0,orderId:"name"},{name:(0,s.__)("E-mail","complianz-gdpr"),selector:e=>e.email,sortable:!0,orderId:"email"},{name:(0,s.__)("Status","complianz-gdpr"),selector:e=>1==e.resolved?(0,s.__)("Resolved","complianz-gdpr"):(0,s.__)("Open","complianz-gdpr"),sortable:!0,orderId:"resolved"},{name:(0,s.__)("Region","complianz-gdpr"),selector:e=>e.region?(0,r.createElement)("img",{alt:"region",width:"20px",height:"20px",src:cmplz_settings.plugin_url+"assets/images/"+e.region+".svg"}):"",sortable:!0},{name:(0,s.__)("Date","complianz-gdpr"),selector:e=>e.request_date,sortable:!0},{name:(0,s.__)("Data Request","complianz-gdpr"),selector:e=>e.type?(0,r.createElement)("a",{target:"_blank",href:"https://complianz.io/"+e.type.slug},e.type.short):"",sortable:!0,orderId:"resolved"}];let L=[...f],q=[];return L.forEach((a=>{let s={...a};s.selectControl=(0,r.createElement)("input",{type:"checkbox",checked:P.includes(s.ID),onChange:a=>((a,r)=>{let s=a.target.checked,l=[...P];s?l.includes(r)||(l.push(r),R(l)):(l=[...P.filter((e=>e!==r))],R(l));let n=t.currentPage?t.currentPage:1,o=f.slice((n-1)*e,n*e),d=!0,i=!1;o.forEach((e=>{l.includes(e.id)?i=!0:d=!1})),d?(u(!0),c(!1)):i?(u(!1),c(!0)):c(!1)})(a,s.ID)}),q.push(s)})),(0,r.createElement)(r.Fragment,null,(0,r.createElement)("div",{className:"cmplz-table-header"},(0,r.createElement)("div",{className:"cmplz-table-header-controls"},(0,r.createElement)("input",{className:"cmplz-datatable-search",type:"text",placeholder:(0,s.__)("Search","complianz-gdpr"),value:b,onChange:t=>(t=>{clearTimeout(h),z(t);const a=setTimeout((()=>{v(e,1,d,p)}),500);_(a)})(t.target.value)}))),P.length>0&&(0,r.createElement)("div",{className:"cmplz-selected-document"},P.length>1&&(0,s.__)("%s items selected","complianz-gdpr").replace("%s",P.length),1===P.length&&(0,s.__)("1 item selected","complianz-gdpr"),(0,r.createElement)("div",{className:"cmplz-selected-document-controls"},f.filter((e=>P.includes(e.ID)&&1!=e.resolved)).length>0&&(0,r.createElement)("button",{disabled:k,className:"button button-default",onClick:()=>y(P)},(0,s.__)("Mark as resolved","complianz-gdpr")),(0,r.createElement)("button",{className:"button button-default cmplz-reset-button",onClick:()=>(async e=>{R([]),await D(e)})(P)},(0,s.__)("Delete","complianz-gdpr")))),x&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)(x,{columns:w,data:q,dense:!0,pagination:!0,paginationServer:!0,noDataComponent:(0,r.createElement)("div",{className:"cmplz-no-documents"},(0,s.__)("No records","really-simple-ssl")),persistTableHead:!0,theme:"really-simple-plugins",customStyles:{headCells:{style:{paddingLeft:"0",paddingRight:"0"}},cells:{style:{paddingLeft:"0",paddingRight:"0"}}},paginationPerPage:e,onChangePage:a=>{n({...t,currentPage:a}),v(e,t.currentPage,d,p)},paginationState:t,paginationTotalRows:I,onChangeRowsPerPage:async(e,a)=>{n({...t,currentPage:a}),v(e,a,d,p)},onSort:async(a,r)=>{i(a.orderId),g(r),v(e,t.currentPage,a.orderId,r)},sortServer:!0})))}))},82640:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});var r=a(30270),s=a(48399),l=a(12902);const n=(0,r.Ue)(((e,t)=>({recordsLoaded:!1,searchValue:"",setSearchValue:t=>e({searchValue:t}),fetching:!1,generating:!1,progress:!1,records:[],totalRecords:0,totalOpen:0,exportLink:"",noData:!1,deleteRecords:async a=>{let r=t().records.filter((e=>a.includes(e.ID)));e((e=>({records:e.records.filter((e=>!a.includes(e.ID)))})));let l={};l.records=r,await s.doAction("delete_datarequests",l).then((e=>e)).catch((e=>{console.error(e)}))},resolveRecords:async a=>{e((0,l.ZP)((e=>{e.records.forEach((function(t,r){a.includes(t.ID)&&(e.records[r].resolved=!0)}))})));let r={};r.records=t().records.filter((e=>a.includes(e.ID))),await s.doAction("resolve_datarequests",r).then((e=>e)).catch((e=>{console.error(e)}))},fetchData:async(a,r,l,n)=>{if(t().fetching)return;e({fetching:!0});let o={};o.per_page=a,o.page=r,o.order=n.toUpperCase(),o.orderBy=l,o.search=t().searchValue;const{records:c,totalRecords:d,totalOpen:i}=await s.doAction("get_datarequests",o).then((e=>e)).catch((e=>{console.error(e)}));e((()=>({recordsLoaded:!0,records:c,totalRecords:d,totalOpen:i,fetching:!1})))},startExport:async()=>{e({generating:!0,progress:0,exportLink:""})},fetchExportDatarequestsProgress:async(t,a,r)=>{(t=void 0!==t&&t)||e({generating:!0});let l={};l.startDate=a,l.endDate=r,l.statusOnly=t;const{progress:n,exportLink:o,noData:c}=await s.doAction("export_datarequests",l).then((e=>e)).catch((e=>{console.error(e)}));let d=!1;n<100&&(d=!0),e({progress:n,exportLink:o,generating:d,noData:c})}})))}}]);