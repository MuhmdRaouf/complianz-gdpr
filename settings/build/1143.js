"use strict";(globalThis.webpackChunkcomplianz_gdpr=globalThis.webpackChunkcomplianz_gdpr||[]).push([[1143,9511],{61143:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var a=n(69307),l=n(65736),c=n(9511);const o=(0,n(99196).memo)((()=>{const{documents:e,downloadUrl:t,deleteDocuments:o,documentsLoaded:s,fetchData:i}=(0,c.default)(),[r,d]=(0,a.useState)(""),[m,u]=(0,a.useState)([]),g=!cmplz_settings.is_premium,[p,h]=(0,a.useState)({}),[f,_]=(0,a.useState)(!1),[b,w]=(0,a.useState)(!1),[y,z]=(0,a.useState)(null);(0,a.useEffect)((()=>{n.e(44).then(n.bind(n,90044)).then((e=>{let{default:t}=e;z((()=>t))}))}),[]),(0,a.useEffect)((()=>{s||i()}),[s]);const E=async()=>{let n=e.filter((e=>m.includes(e.id)));u([]);const a=async()=>{if(n.length>0){const e=n.shift(),l=t+"/"+e.file;d(!0);try{let t=new XMLHttpRequest;t.responseType="blob",t.open("get",l,!0),t.send(),t.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let t=window.URL.createObjectURL(this.response),n=window.document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",e.filename),window.document.body.appendChild(n),n.click(),setTimeout((function(){window.URL.revokeObjectURL(t)}),6e4)}},await a()}catch(e){console.error(e),d(!1)}}};await a(),d(!1)},C=e=>(e.sort(((e,t)=>e.file<t.file?-1:e.file>t.file?1:0)),e),k=[{name:(0,a.createElement)("input",{type:"checkbox",className:f?"indeterminate":"",checked:b,onChange:t=>(t=>{if(t.target.checked){w(!0);let t=p.currentPage?p.currentPage:1,n=C(e).slice(10*(t-1),10*t);u(n.map((e=>e.id)))}else w(!1),u([]);_(!1)})(t)}),selector:e=>e.selectControl},{name:(0,l.__)("Document","complianz-gdpr"),selector:e=>e.file,sortable:!0},{name:(0,l.__)("Region","complianz-gdpr"),selector:e=>(0,a.createElement)("img",{alt:"region",width:"20px",height:"20px",src:cmplz_settings.plugin_url+"assets/images/"+e.region+".svg"}),sortable:!0},{name:(0,l.__)("Consent","complianz-gdpr"),selector:e=>e.consent,sortable:!0},{name:(0,l.__)("Date","complianz-gdpr"),selector:e=>e.time,sortable:!0}];let v=[...e];v=C(v);let D=[];return v.forEach((t=>{let n={...t};n.selectControl=(0,a.createElement)("input",{type:"checkbox",checked:m.includes(n.id),onChange:t=>((t,n)=>{let a=[...m];t?a.includes(n)||(a.push(n),u(a)):(a=[...m.filter((e=>e!==n))],u(a));let l=p.currentPage?p.currentPage:1,c=C(e).slice(10*(l-1),10*l),o=!0,s=!1;c.forEach((e=>{a.includes(e.id)?s=!0:o=!1})),o?(w(!0),_(!1)):s?(w(!1),_(!0)):_(!1)})(!m.includes(n.id),n.id)}),D.push(n)})),(0,a.createElement)(a.Fragment,null,g&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"cmplz-settings-overlay"},(0,a.createElement)("div",{className:"cmplz-settings-overlay-message"}))),m.length>0&&(0,a.createElement)("div",{className:"cmplz-selected-document"},m.length>1&&(0,l.__)("%s items selected","complianz-gdpr").replace("%s",m.length),1===m.length&&(0,l.__)("1 item selected","complianz-gdpr"),(0,a.createElement)("div",{className:"cmplz-selected-document-controls"},(0,a.createElement)("button",{disabled:r,className:"button button-default cmplz-btn-reset",onClick:()=>E()},(0,l.__)("Download Proof of Consent","complianz-gdpr")),(0,a.createElement)("button",{className:"button button-default cmplz-reset-button",onClick:()=>(async e=>{u([]),await o(e)})(m)},(0,l.__)("Delete","complianz-gdpr")))),!g&&y&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(y,{className:"cmplz-data-table",columns:k,data:D,dense:!0,pagination:!0,paginationPerPage:10,onChangePage:e=>{h({...p,currentPage:e})},paginationState:p,noDataComponent:(0,a.createElement)("div",{className:"cmplz-no-documents"},(0,l.__)("No documents","really-simple-ssl")),persistTableHead:!0,theme:"really-simple-plugins",customStyles:{headCells:{style:{paddingLeft:"0",paddingRight:"0"}},cells:{style:{paddingLeft:"0",paddingRight:"0"}}}})))}))},9511:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c});var a=n(30270),l=n(48399);const c=(0,a.Ue)(((e,t)=>({documentsLoaded:!1,fetching:!1,generating:!1,documents:[],downloadUrl:"",regions:[],fields:[],deleteDocuments:async n=>{let a=t().documents.filter((e=>n.includes(e.id)));e((e=>({documents:e.documents.filter((e=>!n.includes(e.id)))})));let c={};c.documents=a,await l.doAction("delete_proof_of_consent_documents",c).then((e=>e)).catch((e=>{console.error(e)}))},generateProofOfConsent:async()=>{e({generating:!0}),await l.doAction("generate_proof_of_consent",{}).then((e=>e)).catch((e=>{console.error(e)})),await t().fetchData(),e({generating:!1})},fetchData:async()=>{if(t().fetching)return;e({fetching:!0});const{documents:n,regions:a,download_url:c}=await l.doAction("get_proof_of_consent_documents",{}).then((e=>e)).catch((e=>{console.error(e)}));e((e=>({documentsLoaded:!0,documents:n,regions:a,downloadUrl:c,fetching:!1})))}})))}}]);