"use strict";(self.webpackChunkcomplianz_gdpr=self.webpackChunkcomplianz_gdpr||[]).push([[9910,881,382,161],{80881:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var r=n(69307),a=n(99196),o=n(48399),c=n(56293),s=n(82485),l=n(55609);const i=(0,a.memo)((e=>{let{type:t="action",style:n="tertiary",label:i,onClick:d,href:u="",target:m="",disabled:p,action:g,field:f,children:h}=e;if(!i&&!h)return null;const _=(f&&f.button_text?f.button_text:i)||h,{fetchFieldsData:b,showSavedSettingsNotice:E}=(0,c.default)(),{selectedSubMenuItem:v}=(0,s.default)(),[y,w]=(0,a.useState)(!1),k=`button cmplz-button button--${n} button-${t}`,z=async e=>{await o.doAction(f.action,{}).then((e=>{e.success&&(b(v),E(e.message))}))},C=f&&f.warn?f.warn:"";return"action"===t?(0,r.createElement)(r.Fragment,null,(0,r.createElement)(l.__experimentalConfirmDialog,{isOpen:y,onConfirm:async()=>{w(!1),await z()},onCancel:()=>{w(!1)}},C),(0,r.createElement)("button",{className:k,onClick:async e=>{"action"===t&&d?d(e):"action"===t&&g?f&&f.warn?w(!0):await z():window.location.href=f.url},disabled:p},_)):"link"===t?(0,r.createElement)("a",{className:k,href:u,target:m},_):void 0}))},382:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var r=n(69307),a=n(87462),o=n(99196),c=n(28771),s=n(25360),l=n(36206),i=n(77342),d=n(57898),u=n(7546),m=n(29115),p=n(75320);const g="Checkbox",[f,h]=(0,s.b)(g),[_,b]=f(g),E=(0,o.forwardRef)(((e,t)=>{const{__scopeCheckbox:n,name:r,checked:s,defaultChecked:d,required:u,disabled:m,value:g="on",onCheckedChange:f,...h}=e,[b,E]=(0,o.useState)(null),k=(0,c.e)(t,(e=>E(e))),z=(0,o.useRef)(!1),C=!b||Boolean(b.closest("form")),[N=!1,x]=(0,i.T)({prop:s,defaultProp:d,onChange:f}),L=(0,o.useRef)(N);return(0,o.useEffect)((()=>{const e=null==b?void 0:b.form;if(e){const t=()=>x(L.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}}),[b,x]),(0,o.createElement)(_,{scope:n,state:N,disabled:m},(0,o.createElement)(p.WV.button,(0,a.Z)({type:"button",role:"checkbox","aria-checked":y(N)?"mixed":N,"aria-required":u,"data-state":w(N),"data-disabled":m?"":void 0,disabled:m,value:g},h,{ref:k,onKeyDown:(0,l.M)(e.onKeyDown,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:(0,l.M)(e.onClick,(e=>{x((e=>!!y(e)||!e)),C&&(z.current=e.isPropagationStopped(),z.current||e.stopPropagation())}))})),C&&(0,o.createElement)(v,{control:b,bubbles:!z.current,name:r,value:g,checked:N,required:u,disabled:m,style:{transform:"translateX(-100%)"}}))})),v=e=>{const{control:t,checked:n,bubbles:r=!0,...c}=e,s=(0,o.useRef)(null),l=(0,d.D)(n),i=(0,u.t)(t);return(0,o.useEffect)((()=>{const e=s.current,t=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(t,"checked").set;if(l!==n&&a){const t=new Event("click",{bubbles:r});e.indeterminate=y(n),a.call(e,!y(n)&&n),e.dispatchEvent(t)}}),[l,n,r]),(0,o.createElement)("input",(0,a.Z)({type:"checkbox","aria-hidden":!0,defaultChecked:!y(n)&&n},c,{tabIndex:-1,ref:s,style:{...e.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function y(e){return"indeterminate"===e}function w(e){return y(e)?"indeterminate":e?"checked":"unchecked"}const k=E,z=(0,o.forwardRef)(((e,t)=>{const{__scopeCheckbox:n,forceMount:r,...c}=e,s=b("CheckboxIndicator",n);return(0,o.createElement)(m.z,{present:r||y(s.state)||!0===s.state},(0,o.createElement)(p.WV.span,(0,a.Z)({"data-state":w(s.state),"data-disabled":s.disabled?"":void 0},c,{ref:t,style:{pointerEvents:"none",...e.style}})))}));var C=n(65736),N=n(20384),x=n(80881);const L=(0,o.memo)((e=>{let{indeterminate:t,label:n,value:a,id:c,onChange:s,required:l,disabled:i,options:d={}}=e,u=a;Array.isArray(u)||(u=""===u?[]:[u]),t&&(a=!0);const m=u,[p,g]=(0,o.useState)(!1);let f=!1;Object.keys(d).length>10&&(f=!0);const h=e=>m.includes(e),_=()=>{g(!p)};let b=i&&!Array.isArray(i);return(0,r.createElement)("div",{className:"cmplz-checkbox-group"},Object.entries(d).map(((e,o)=>{let[u,g]=e;return(0,r.createElement)("div",{key:u,className:"cmplz-checkbox-group__item"+(!p&&o>10?" cmplz-hidden":"")},(0,r.createElement)(k,{className:"cmplz-checkbox-group__checkbox",id:c+"_"+u,checked:1===Object.keys(d).length?a:h(u),"aria-label":n,disabled:b||Array.isArray(i)&&i.includes(u),required:l,onCheckedChange:e=>((e,t)=>{if(1===Object.keys(d).length)s(!a);else{const e=m.includes(t)?m.filter((e=>e!==t)):[...m,t];s(e)}})(0,u)},(0,r.createElement)(z,{className:"cmplz-checkbox-group__indicator"},(0,r.createElement)(N.default,{name:t?"indeterminate":"check",size:14,color:"dark-blue"}))),(0,r.createElement)("label",{className:"cmplz-checkbox-group__label",htmlFor:c+"_"+u},g))})),!p&&f&&(0,r.createElement)(x.default,{onClick:_},(0,C.__)("Show more","complianz-gdpr")),p&&f&&(0,r.createElement)(x.default,{onClick:_},(0,C.__)("Show less","complianz-gdpr")))}))},49910:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(69307),a=n(65736),o=n(80161),c=n(99196),s=n(382);const l=(0,c.memo)((()=>{const[e,t]=(0,r.useState)(""),[c,l]=(0,r.useState)({}),[i,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),{records:p,downloadUrl:g,deleteRecords:f,recordsLoaded:h,fetchData:_}=(0,o.default)(),[b,E]=(0,r.useState)(""),[v,y]=(0,r.useState)([]),w=!cmplz_settings.is_premium,[k,z]=(0,r.useState)(null);(0,r.useEffect)((()=>{n.e(44).then(n.bind(n,90044)).then((e=>{let{default:t}=e;z((()=>t))}))}),[]),(0,r.useEffect)((()=>{!h&&cmplz_settings.is_premium&&_()}),[h]);const C=async()=>{let e=p.filter((e=>v.includes(e.id)&&""!==e.poc_url));y([]);const t=async()=>{if(e.length>0){const n=e.shift(),r=g+"/"+n.poc_url;E(!0);try{let e=new XMLHttpRequest;e.responseType="blob",e.open("get",r,!0),e.send(),e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let e=window.URL.createObjectURL(this.response),t=window.document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",n.filename),window.document.body.appendChild(t),t.click(),setTimeout((function(){window.URL.revokeObjectURL(e)}),6e4)}},await t()}catch(e){console.error(e),E(!1)}}};await t(),E(!1)},N={optin:(0,a.__)("Opt-in","complianz-gdpr"),optout:(0,a.__)("Opt-out","complianz-gdpr"),other:(0,a.__)("Other","complianz-gdpr")},x=t=>(t=t.sort(((e,t)=>e.file<t.file?-1:e.file>t.file?1:0))).filter((t=>t.ip.toLowerCase().includes(e.toLowerCase())||t.services.toLowerCase().includes(e.toLowerCase())||t.id.toLowerCase().includes(e.toLowerCase()))),L=[{name:(0,r.createElement)(s.default,{options:{true:""},indeterminate:i,value:u,onChange:e=>(e=>{if(e){m(!0);let e=c.currentPage?c.currentPage:1,t=x(p).slice(10*(e-1),10*e);y(t.map((e=>e.id)))}else m(!1),y([]);d(!1)})(e)}),selector:e=>e.selectControl,grow:1,minWidth:"50px"},{name:(0,a.__)("User ID","complianz-gdpr"),selector:e=>e.id,sortable:!0,grow:3},{name:(0,a.__)("IP Address","complianz-gdpr"),selector:e=>e.ip,sortable:!0,grow:4},{name:(0,a.__)("Region","complianz-gdpr"),selector:e=>""!==e.region?(0,r.createElement)("img",{alt:"region",width:"20px",height:"20px",src:cmplz_settings.plugin_url+"assets/images/"+e.region+".svg"}):"",sortable:!0,grow:2},{name:(0,a.__)("Services","complianz-gdpr"),selector:e=>e.services,sortable:!0,grow:5},{name:(0,a.__)("Consent","complianz-gdpr"),selector:e=>e.consenttype?N[e.consenttype]:"",sortable:!0,grow:3},{name:(0,a.__)("Categories","complianz-gdpr"),selector:e=>(e=>{let t={do_not_track:(0,a.__)("DNT/GPC","complianz-gdpr"),no_choice:(0,a.__)("No Choice","complianz-gdpr"),no_warning:(0,a.__)("No Warning","complianz-gdpr"),functional:(0,a.__)("Functional","complianz-gdpr"),preferences:(0,a.__)("Preferences","complianz-gdpr"),statistics:(0,a.__)("Statistics","complianz-gdpr"),marketing:(0,a.__)("Marketing","complianz-gdpr")},n=[];return Object.keys(t).forEach((r=>{1===parseInt(e[r])&&n.push(t[r])})),n.join(", ")})(e),sortable:!0,grow:6},{name:(0,a.__)("Date","complianz-gdpr"),selector:e=>e.time,sortable:!0,grow:4,minWidth:"200px",right:!0}];let O=[...p];O=x(O);let S=[];return O.forEach((e=>{let t={...e};t.selectControl=(0,r.createElement)(s.default,{value:v.includes(t.id),options:{true:""},onChange:e=>((e,t)=>{let n=[...v];e?n.includes(t)||(n.push(t),y(n)):(n=[...v.filter((e=>e!==t))],y(n));let r=c.currentPage?c.currentPage:1,a=x(p).slice(10*(r-1),10*r),o=!0,s=!1;a.forEach((e=>{n.includes(e.id)?s=!0:o=!1})),o?(m(!0),d(!1)):s?(m(!1),d(!0)):d(!1)})(e,t.id)}),S.push(t)})),(0,r.createElement)(r.Fragment,null,w&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)("div",{className:"cmplz-settings-overlay"},(0,r.createElement)("div",{className:"cmplz-settings-overlay-message"}))),(0,r.createElement)("div",{className:"cmplz-table-header"},(0,r.createElement)("div",{className:"cmplz-table-header-controls"},(0,r.createElement)("input",{className:"cmplz-datatable-search",type:"text",placeholder:(0,a.__)("Search","complianz-gdpr"),value:e,onChange:e=>t(e.target.value)}))),v.length>0&&(0,r.createElement)("div",{className:"cmplz-selected-document"},v.length>1&&(0,a.__)("%s items selected","complianz-gdpr").replace("%s",v.length),1===v.length&&(0,a.__)("1 item selected","complianz-gdpr"),(0,r.createElement)("div",{className:"cmplz-selected-document-controls"},p.filter((e=>v.includes(e.id)&&""!==e.poc_url)).length>0&&(0,r.createElement)("button",{disabled:b,className:"button button-default cmplz-btn-reset",onClick:()=>C()},(0,a.__)("Download Proof of Consent","complianz-gdpr")),(0,r.createElement)("button",{className:"button button-default cmplz-reset-button",onClick:()=>(async e=>{y([]),await f(e)})(v)},(0,a.__)("Delete","complianz-gdpr")))),!w&&k&&(0,r.createElement)(r.Fragment,null,(0,r.createElement)(k,{columns:L,data:S,dense:!0,pagination:!0,noDataComponent:(0,r.createElement)("div",{className:"cmplz-no-documents"},(0,a.__)("No records","really-simple-ssl")),persistTableHead:!0,theme:"really-simple-plugins",customStyles:{headCells:{style:{paddingLeft:"0",paddingRight:"0"}},cells:{style:{paddingLeft:"0",paddingRight:"0"}}},paginationPerPage:10,onChangePage:e=>{l({...c,currentPage:e})},paginationState:c})))}))},80161:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var r=n(30270),a=n(48399);const o=(0,r.Ue)(((e,t)=>({recordsLoaded:!1,fetching:!1,generating:!1,progress:!1,records:[],exportLink:"",downloadUrl:"",regions:[],fields:[],noData:!1,deleteRecords:async n=>{let r=t().records.filter((e=>n.includes(e.id)));e((e=>({records:e.records.filter((e=>!n.includes(e.id)))})));let o={};o.records=r,await a.doAction("delete_records_of_consent",o).then((e=>e)).catch((e=>{console.error(e)}))},fetchData:async()=>{if(t().fetching)return;e({fetching:!0});const{records:n,regions:r,download_url:o}=await a.doAction("get_records_of_consent",{}).then((e=>e)).catch((e=>{console.error(e)}));e((()=>({recordsLoaded:!0,records:n,regions:r,downloadUrl:o,fetching:!1})))},startExport:async()=>{e({generating:!0,progress:0,exportLink:""})},fetchExportRecordsOfConsentProgress:async(t,n,r)=>{(t=void 0!==t&&t)||e({generating:!0});let o={};o.startDate=n,o.endDate=r,o.statusOnly=t;const{progress:c,exportLink:s,noData:l}=await a.doAction("export_records_of_consent",o).then((e=>e)).catch((e=>{console.error(e)}));let i=!1;c<100&&(i=!0),e({progress:c,exportLink:s,generating:i,noData:l})}})))},29115:(e,t,n)=>{n.d(t,{z:()=>s});var r=n(99196),a=n(91850),o=n(28771),c=n(9981);const s=e=>{const{present:t,children:n}=e,s=function(e){const[t,n]=(0,r.useState)(),o=(0,r.useRef)({}),s=(0,r.useRef)(e),i=(0,r.useRef)("none"),d=e?"mounted":"unmounted",[u,m]=function(e,t){return(0,r.useReducer)(((e,n)=>{const r=t[e][n];return null!=r?r:e}),e)}(d,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return(0,r.useEffect)((()=>{const e=l(o.current);i.current="mounted"===u?e:"none"}),[u]),(0,c.b)((()=>{const t=o.current,n=s.current;if(n!==e){const r=i.current,a=l(t);e?m("MOUNT"):"none"===a||"none"===(null==t?void 0:t.display)?m("UNMOUNT"):m(n&&r!==a?"ANIMATION_OUT":"UNMOUNT"),s.current=e}}),[e,m]),(0,c.b)((()=>{if(t){const e=e=>{const n=l(o.current).includes(e.animationName);e.target===t&&n&&(0,a.flushSync)((()=>m("ANIMATION_END")))},n=e=>{e.target===t&&(i.current=l(o.current))};return t.addEventListener("animationstart",n),t.addEventListener("animationcancel",e),t.addEventListener("animationend",e),()=>{t.removeEventListener("animationstart",n),t.removeEventListener("animationcancel",e),t.removeEventListener("animationend",e)}}m("ANIMATION_END")}),[t,m]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:(0,r.useCallback)((e=>{e&&(o.current=getComputedStyle(e)),n(e)}),[])}}(t),i="function"==typeof n?n({present:s.isPresent}):r.Children.only(n),d=(0,o.e)(s.ref,i.ref);return"function"==typeof n||s.isPresent?(0,r.cloneElement)(i,{ref:d}):null};function l(e){return(null==e?void 0:e.animationName)||"none"}s.displayName="Presence"},57898:(e,t,n)=>{n.d(t,{D:()=>a});var r=n(99196);function a(e){const t=(0,r.useRef)({value:e,previous:e});return(0,r.useMemo)((()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous)),[e])}}}]);