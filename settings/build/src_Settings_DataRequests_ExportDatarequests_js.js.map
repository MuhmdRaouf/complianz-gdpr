{"version":3,"file":"src_Settings_DataRequests_ExportDatarequests_js.js","mappings":"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","sources":["webpack://complianz-gdpr/./src/DateRange/useDateStore.js","webpack://complianz-gdpr/./src/Settings/DataRequests/ExportDatarequests.js","webpack://complianz-gdpr/./src/Settings/DataRequests/useDatarequestsData.js"],"sourcesContent":["import {create} from 'zustand';\nimport {endOfDay, format, startOfDay, subDays} from 'date-fns';\n\n// define the store\nexport const useDate = create(set => ({\n\tstartDate: format(startOfDay(subDays(new Date(), 7)), 'yyyy-MM-dd'),\n\tsetStartDate: (startDate) => set(state => ({ startDate })),\n\tendDate: format(endOfDay(subDays(new Date(), 1)), 'yyyy-MM-dd'),\n\tsetEndDate: (endDate) => set(state => ({ endDate })),\n\trange: 'last-7-days',\n\tsetRange: (range) => set(state => ({ range })),\n}));\nexport default useDate;\n","import { __ } from '@wordpress/i18n';\nimport {useState, useEffect} from \"@wordpress/element\";\nimport useDatarequestsData from \"./useDatarequestsData\";\nimport Icon from \"../../utils/Icon\";\nimport useDate from \"../../DateRange/useDateStore\";\nimport {memo} from \"react\";\nconst ExportDatarequests = () => {\n\tconst { noData, startExport, exportLink, fetchExportDatarequestsProgress, generating, progress} = useDatarequestsData();\n\tconst [DateRange, setDateRange] = useState(null);\n\tconst {startDate, endDate} = useDate();\n\tuseEffect( () => {\n\t\timport('../../DateRange/DateRange').then(({ default: DateRange }) => {\n\t\t\tsetDateRange(() => DateRange);\n\t\t});\n\t}, []);\n\n\t//check if there's an export running\n\tuseEffect ( () => {\n\t\tfetchExportDatarequestsProgress(true);\n\t},[]);\n\n\tuseEffect( () => {\n\t\t//startDate, endDate\n\t\tif (progress<100 && generating ) {\n\t\t\tfetchExportDatarequestsProgress(false, startDate, endDate);\n\t\t}\n\t}, [progress]);\n\treturn (\n\t\t<>\n\t\t\t\t<div className=\"cmplz-table-header-controls\">\n\t\t\t\t\t{DateRange && <DateRange />}\n\t\t\t\t\t<button disabled={generating} className=\"button button-default cmplz-field-button\" onClick={()=>startExport()} >\n\t\t\t\t\t\t{__(\"Export to CSV\",\"complianz-gdpr\")}\n\t\t\t\t\t\t{generating && <><Icon name = \"loading\" color = 'grey' />&nbsp;{progress}%</>}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t{ progress>=100 && (exportLink!=='' || noData ) &&\n\t\t\t\t<div className=\"cmplz-selected-document\">\n\t\t\t\t\t{!noData && __(\"Your Data Requests Export has been completed.\",\"complianz-gdpr\")}\n\t\t\t\t\t{noData && __(\"Your selection does not contain any data.\",\"complianz-gdpr\")}\n\t\t\t\t\t<div className=\"cmplz-selected-document-controls\">\n\t\t\t\t\t\t{!noData && <a className=\"button button-default\" href={exportLink}>{__(\"Download\",\"complianz-gdpr\")}</a> }\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t</>\n\t)\n}\nexport default memo(ExportDatarequests)\n","import {create} from 'zustand';\nimport * as cmplz_api from \"../../utils/api\";\nimport produce from \"immer\";\nconst useDatarequestsData = create(( set, get ) => ({\n\trecordsLoaded: false,\n\tsearchValue: '',\n\tsetSearchValue: (value) => set({searchValue: value}),\n\tfetching:false,\n\tgenerating:false,\n\tprogress:false,\n\trecords: [],\n\ttotalRecords:0,\n\ttotalOpen:0,\n\texportLink: '',\n\tnoData:false,\n\tdeleteRecords: async (ids) => {\n\t\t//get array of records to delete\n\t\tlet deleteRecords = get().records.filter(record => ids.includes(record.ID));\n\t\t//remove the ids from the records array\n\t\tset((state) => ({\n\t\t\trecords: state.records.filter(record => !ids.includes(record.ID)),\n\t\t}));\n\t\tlet data = {};\n\t\tdata.records = deleteRecords;\n\t\tawait cmplz_api.doAction('delete_datarequests', data).then((response) => {\n\t\t\treturn response;\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t},\n\tresolveRecords: async (ids) => {\n\t\t//get array of records to resolve\n\t\tset(\n\t\t\tproduce((state) => {\n\t\t\t\tstate.records.forEach(function(record, i) {\n\t\t\t\t\tif (ids.includes(record.ID) ){\n\t\t\t\t\t\tstate.records[i].resolved = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t)\n\t\tlet data = {};\n\t\tdata.records = get().records.filter(record => ids.includes(record.ID));\n\t\tawait cmplz_api.doAction('resolve_datarequests', data).then((response) => {\n\t\t\treturn response;\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t},\n\tfetchData: async (perPage, page, orderBy, order ) => {\n\t\tif (get().fetching) return;\n\t\tset({fetching:true});\n\t\tlet data = {}\n\t\tdata.per_page = perPage;\n\t\tdata.page = page;\n\t\tdata.order = order.toUpperCase();\n\t\tdata.orderBy = orderBy;\n\t\tdata.search = get().searchValue;\n\t\tconst { records, totalRecords, totalOpen} = await cmplz_api.doAction('get_datarequests', data).then((response) => {\n\t\t\treturn response;\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\n\t\tset(() => ({\n\t\t\trecordsLoaded: true,\n\t\t\trecords: records,\n\t\t\ttotalRecords: totalRecords,\n\t\t\ttotalOpen:totalOpen,\n\t\t\tfetching:false,\n\t\t}));\n\t},\n\tstartExport: async () => {\n\t\tset({\n\t\t\tgenerating: true,\n\t\t\tprogress:0,\n\t\t\texportLink: '',\n\t\t})\n\t},\n\tfetchExportDatarequestsProgress: async (statusOnly, startDate, endDate) => {\n\t\tstatusOnly = typeof statusOnly !== 'undefined' ? statusOnly : false;\n\t\tif (!statusOnly) {\n\t\t\tset({ generating:true });\n\t\t}\n\n\t\tlet data = {};\n\t\tdata.startDate = startDate;\n\t\tdata.endDate = endDate;\n\t\tdata.statusOnly = statusOnly;\n\t\tconst {progress, exportLink, noData} = await cmplz_api.doAction('export_datarequests', data).then((response) => {\n\t\t\treturn response;\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t\tlet generating = false;\n\t\tif (progress<100 ){\n\t\t\tgenerating = true;\n\t\t}\n\t\tset({progress:progress, exportLink:exportLink, generating:generating, noData:noData});\n\n\t},\n}));\n\nexport default useDatarequestsData;\n"],"names":["create","endOfDay","format","startOfDay","subDays","useDate","set","startDate","Date","setStartDate","state","endDate","setEndDate","range","setRange","__","useState","useEffect","useDatarequestsData","Icon","memo","ExportDatarequests","noData","startExport","exportLink","fetchExportDatarequestsProgress","generating","progress","DateRange","setDateRange","then","_ref","default","createElement","Fragment","className","disabled","onClick","name","color","href","cmplz_api","produce","get","recordsLoaded","searchValue","setSearchValue","value","fetching","records","totalRecords","totalOpen","deleteRecords","ids","filter","record","includes","ID","data","doAction","response","catch","error","console","resolveRecords","forEach","i","resolved","fetchData","perPage","page","orderBy","order","per_page","toUpperCase","search","statusOnly"],"sourceRoot":""}