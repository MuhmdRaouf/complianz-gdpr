"use strict";(self.webpackChunkcomplianz_gdpr=self.webpackChunkcomplianz_gdpr||[]).push([[1143,881,382,9511],{80881:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var a=n(69307),r=n(99196),o=n(48399),c=n(56293),l=n(82485),s=n(55609);const i=(0,r.memo)((e=>{let{type:t="action",style:n="tertiary",label:i,onClick:d,href:u="",target:m="",disabled:p,action:f,field:g,children:h}=e;if(!i&&!h)return null;const b=(g&&g.button_text?g.button_text:i)||h,{fetchFieldsData:_,showSavedSettingsNotice:E}=(0,c.default)(),{selectedSubMenuItem:v}=(0,l.default)(),[y,w]=(0,r.useState)(!1),k=`button cmplz-button button--${n} button-${t}`,N=async e=>{await o.doAction(g.action,{}).then((e=>{e.success&&(_(v),E(e.message))}))},C=g&&g.warn?g.warn:"";return"action"===t?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.__experimentalConfirmDialog,{isOpen:y,onConfirm:async()=>{w(!1),await N()},onCancel:()=>{w(!1)}},C),(0,a.createElement)("button",{className:k,onClick:async e=>{"action"===t&&d?d(e):"action"===t&&f?g&&g.warn?w(!0):await N():window.location.href=g.url},disabled:p},b)):"link"===t?(0,a.createElement)("a",{className:k,href:u,target:m},b):void 0}))},382:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var a=n(69307),r=n(87462),o=n(99196),c=n(28771),l=n(25360),s=n(36206),i=n(77342),d=n(57898),u=n(7546),m=n(29115),p=n(75320);const f="Checkbox",[g,h]=(0,l.b)(f),[b,_]=g(f),E=(0,o.forwardRef)(((e,t)=>{const{__scopeCheckbox:n,name:a,checked:l,defaultChecked:d,required:u,disabled:m,value:f="on",onCheckedChange:g,...h}=e,[_,E]=(0,o.useState)(null),k=(0,c.e)(t,(e=>E(e))),N=(0,o.useRef)(!1),C=!_||Boolean(_.closest("form")),[z=!1,S]=(0,i.T)({prop:l,defaultProp:d,onChange:g}),O=(0,o.useRef)(z);return(0,o.useEffect)((()=>{const e=null==_?void 0:_.form;if(e){const t=()=>S(O.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}}),[_,S]),(0,o.createElement)(b,{scope:n,state:z,disabled:m},(0,o.createElement)(p.WV.button,(0,r.Z)({type:"button",role:"checkbox","aria-checked":y(z)?"mixed":z,"aria-required":u,"data-state":w(z),"data-disabled":m?"":void 0,disabled:m,value:f},h,{ref:k,onKeyDown:(0,s.M)(e.onKeyDown,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:(0,s.M)(e.onClick,(e=>{S((e=>!!y(e)||!e)),C&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())}))})),C&&(0,o.createElement)(v,{control:_,bubbles:!N.current,name:a,value:f,checked:z,required:u,disabled:m,style:{transform:"translateX(-100%)"}}))})),v=e=>{const{control:t,checked:n,bubbles:a=!0,...c}=e,l=(0,o.useRef)(null),s=(0,d.D)(n),i=(0,u.t)(t);return(0,o.useEffect)((()=>{const e=l.current,t=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(t,"checked").set;if(s!==n&&r){const t=new Event("click",{bubbles:a});e.indeterminate=y(n),r.call(e,!y(n)&&n),e.dispatchEvent(t)}}),[s,n,a]),(0,o.createElement)("input",(0,r.Z)({type:"checkbox","aria-hidden":!0,defaultChecked:!y(n)&&n},c,{tabIndex:-1,ref:l,style:{...e.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function y(e){return"indeterminate"===e}function w(e){return y(e)?"indeterminate":e?"checked":"unchecked"}const k=E,N=(0,o.forwardRef)(((e,t)=>{const{__scopeCheckbox:n,forceMount:a,...c}=e,l=_("CheckboxIndicator",n);return(0,o.createElement)(m.z,{present:a||y(l.state)||!0===l.state},(0,o.createElement)(p.WV.span,(0,r.Z)({"data-state":w(l.state),"data-disabled":l.disabled?"":void 0},c,{ref:t,style:{pointerEvents:"none",...e.style}})))}));var C=n(65736),z=n(20384),S=n(80881);const O=(0,o.memo)((e=>{let{indeterminate:t,label:n,value:r,id:c,onChange:l,required:s,disabled:i,options:d={}}=e,u=r;Array.isArray(u)||(u=""===u?[]:[u]),t&&(r=!0);const m=u,[p,f]=(0,o.useState)(!1);let g=!1;Object.keys(d).length>10&&(g=!0);const h=e=>m.includes(e),b=()=>{f(!p)};let _=i&&!Array.isArray(i);return(0,a.createElement)("div",{className:"cmplz-checkbox-group"},Object.entries(d).map(((e,o)=>{let[u,f]=e;return(0,a.createElement)("div",{key:u,className:"cmplz-checkbox-group__item"+(!p&&o>10?" cmplz-hidden":"")},(0,a.createElement)(k,{className:"cmplz-checkbox-group__checkbox",id:c+"_"+u,checked:1===Object.keys(d).length?r:h(u),"aria-label":n,disabled:_||Array.isArray(i)&&i.includes(u),required:s,onCheckedChange:e=>((e,t)=>{if(1===Object.keys(d).length)l(!r);else{const e=m.includes(t)?m.filter((e=>e!==t)):[...m,t];l(e)}})(0,u)},(0,a.createElement)(N,{className:"cmplz-checkbox-group__indicator"},(0,a.createElement)(z.default,{name:t?"indeterminate":"check",size:14,color:"dark-blue"}))),(0,a.createElement)("label",{className:"cmplz-checkbox-group__label",htmlFor:c+"_"+u},f))})),!p&&g&&(0,a.createElement)(S.default,{onClick:b},(0,C.__)("Show more","complianz-gdpr")),p&&g&&(0,a.createElement)(S.default,{onClick:b},(0,C.__)("Show less","complianz-gdpr")))}))},61143:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var a=n(69307),r=n(382),o=n(65736),c=n(9511);const l=(0,n(99196).memo)((()=>{const{documents:e,downloadUrl:t,deleteDocuments:l,documentsLoaded:s,fetchData:i}=(0,c.default)(),[d,u]=(0,a.useState)(""),[m,p]=(0,a.useState)([]),f=!cmplz_settings.is_premium,[g,h]=(0,a.useState)({}),[b,_]=(0,a.useState)(!1),[E,v]=(0,a.useState)(!1),[y,w]=(0,a.useState)(null);(0,a.useEffect)((()=>{n.e(44).then(n.bind(n,90044)).then((e=>{let{default:t}=e;w((()=>t))}))}),[]),(0,a.useEffect)((()=>{s||i()}),[s]);const k=async()=>{let n=e.filter((e=>m.includes(e.id)));p([]);const a=async()=>{if(n.length>0){const e=n.shift(),r=t+"/"+e.file;u(!0);try{let t=new XMLHttpRequest;t.responseType="blob",t.open("get",r,!0),t.send(),t.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let t=window.URL.createObjectURL(this.response),n=window.document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",e.filename),window.document.body.appendChild(n),n.click(),setTimeout((function(){window.URL.revokeObjectURL(t)}),6e4)}},await a()}catch(e){console.error(e),u(!1)}}};await a(),u(!1)},N=e=>(e.sort(((e,t)=>e.file<t.file?-1:e.file>t.file?1:0)),e),C=[{name:(0,a.createElement)(r.default,{options:{true:""},indeterminate:b,value:E,onChange:t=>(t=>{if(t){v(!0);let t=g.currentPage?g.currentPage:1,n=N(e).slice(10*(t-1),10*t);p(n.map((e=>e.id)))}else v(!1),p([]);_(!1)})(t)}),selector:e=>e.selectControl,grow:1,minWidth:"50px"},{name:(0,o.__)("Document","complianz-gdpr"),selector:e=>e.file,sortable:!0,grow:5},{name:(0,o.__)("Region","complianz-gdpr"),selector:e=>(0,a.createElement)("img",{alt:"region",width:"20px",height:"20px",src:cmplz_settings.plugin_url+"assets/images/"+e.region+".svg"}),sortable:!0,grow:2,right:!0},{name:(0,o.__)("Consent","complianz-gdpr"),selector:e=>e.consent,sortable:!0,grow:2,right:!0},{name:(0,o.__)("Date","complianz-gdpr"),selector:e=>e.time,sortable:!0,grow:4,right:!0}];let z=[...e];z=N(z);let S=[];return z.forEach((t=>{let n={...t};n.selectControl=(0,a.createElement)(r.default,{value:m.includes(n.id),options:{true:""},onChange:t=>((t,n)=>{let a=[...m];t?a.includes(n)||(a.push(n),p(a)):(a=[...m.filter((e=>e!==n))],p(a));let r=g.currentPage?g.currentPage:1,o=N(e).slice(10*(r-1),10*r),c=!0,l=!1;o.forEach((e=>{a.includes(e.id)?l=!0:c=!1})),c?(v(!0),_(!1)):l?(v(!1),_(!0)):_(!1)})(!m.includes(n.id),n.id)}),S.push(n)})),(0,a.createElement)(a.Fragment,null,f&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"cmplz-settings-overlay"},(0,a.createElement)("div",{className:"cmplz-settings-overlay-message"}))),m.length>0&&(0,a.createElement)("div",{className:"cmplz-selected-document"},m.length>1&&(0,o.__)("%s items selected","complianz-gdpr").replace("%s",m.length),1===m.length&&(0,o.__)("1 item selected","complianz-gdpr"),(0,a.createElement)("div",{className:"cmplz-selected-document-controls"},(0,a.createElement)("button",{disabled:d,className:"button button-default cmplz-btn-reset",onClick:()=>k()},(0,o.__)("Download Proof of Consent","complianz-gdpr")),(0,a.createElement)("button",{className:"button button-default cmplz-reset-button",onClick:()=>(async e=>{p([]),await l(e)})(m)},(0,o.__)("Delete","complianz-gdpr")))),!f&&y&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(y,{className:"cmplz-data-table",columns:C,data:S,dense:!0,pagination:!0,paginationPerPage:10,onChangePage:e=>{h({...g,currentPage:e})},paginationState:g,noDataComponent:(0,a.createElement)("div",{className:"cmplz-no-documents"},(0,o.__)("No documents","really-simple-ssl")),persistTableHead:!0,theme:"really-simple-plugins",customStyles:{headCells:{style:{paddingLeft:"0",paddingRight:"0"}},cells:{style:{paddingLeft:"0",paddingRight:"0"}}}})))}))},9511:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var a=n(30270),r=n(48399);const o=(0,a.Ue)(((e,t)=>({documentsLoaded:!1,fetching:!1,generating:!1,documents:[],downloadUrl:"",regions:[],fields:[],deleteDocuments:async n=>{let a=t().documents.filter((e=>n.includes(e.id)));e((e=>({documents:e.documents.filter((e=>!n.includes(e.id)))})));let o={};o.documents=a,await r.doAction("delete_proof_of_consent_documents",o).then((e=>e)).catch((e=>{console.error(e)}))},generateProofOfConsent:async()=>{e({generating:!0}),await r.doAction("generate_proof_of_consent",{}).then((e=>e)).catch((e=>{console.error(e)})),await t().fetchData(),e({generating:!1})},fetchData:async()=>{if(t().fetching)return;e({fetching:!0});const{documents:n,regions:a,download_url:o}=await r.doAction("get_proof_of_consent_documents",{}).then((e=>e)).catch((e=>{console.error(e)}));e((e=>({documentsLoaded:!0,documents:n,regions:a,downloadUrl:o,fetching:!1})))}})))},29115:(e,t,n)=>{n.d(t,{z:()=>l});var a=n(99196),r=n(91850),o=n(28771),c=n(9981);const l=e=>{const{present:t,children:n}=e,l=function(e){const[t,n]=(0,a.useState)(),o=(0,a.useRef)({}),l=(0,a.useRef)(e),i=(0,a.useRef)("none"),d=e?"mounted":"unmounted",[u,m]=function(e,t){return(0,a.useReducer)(((e,n)=>{const a=t[e][n];return null!=a?a:e}),e)}(d,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return(0,a.useEffect)((()=>{const e=s(o.current);i.current="mounted"===u?e:"none"}),[u]),(0,c.b)((()=>{const t=o.current,n=l.current;if(n!==e){const a=i.current,r=s(t);e?m("MOUNT"):"none"===r||"none"===(null==t?void 0:t.display)?m("UNMOUNT"):m(n&&a!==r?"ANIMATION_OUT":"UNMOUNT"),l.current=e}}),[e,m]),(0,c.b)((()=>{if(t){const e=e=>{const n=s(o.current).includes(e.animationName);e.target===t&&n&&(0,r.flushSync)((()=>m("ANIMATION_END")))},n=e=>{e.target===t&&(i.current=s(o.current))};return t.addEventListener("animationstart",n),t.addEventListener("animationcancel",e),t.addEventListener("animationend",e),()=>{t.removeEventListener("animationstart",n),t.removeEventListener("animationcancel",e),t.removeEventListener("animationend",e)}}m("ANIMATION_END")}),[t,m]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:(0,a.useCallback)((e=>{e&&(o.current=getComputedStyle(e)),n(e)}),[])}}(t),i="function"==typeof n?n({present:l.isPresent}):a.Children.only(n),d=(0,o.e)(l.ref,i.ref);return"function"==typeof n||l.isPresent?(0,a.cloneElement)(i,{ref:d}):null};function s(e){return(null==e?void 0:e.animationName)||"none"}l.displayName="Presence"},57898:(e,t,n)=>{n.d(t,{D:()=>r});var a=n(99196);function r(e){const t=(0,a.useRef)({value:e,previous:e});return(0,a.useMemo)((()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous)),[e])}}}]);