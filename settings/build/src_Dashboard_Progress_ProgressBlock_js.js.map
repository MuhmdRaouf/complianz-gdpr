{"version":3,"file":"src_Dashboard_Progress_ProgressBlock_js.js","mappings":"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","sources":["webpack://complianz-gdpr/./src/Dashboard/Progress/ProgressBlock.js","webpack://complianz-gdpr/./src/Dashboard/TaskElement.js","webpack://complianz-gdpr/./src/utils/sleeper.js"],"sourcesContent":["import {\n    useEffect\n} from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\nimport TaskElement from \"./../TaskElement\";\nimport Placeholder from '../../Placeholder/Placeholder';\nimport useProgress from \"./ProgressData\";\nimport useFields from \"../../Settings/Fields/FieldsData\";\n\nconst ProgressBlock = () => {\n    const {percentageCompleted, filter, notices, progressLoaded, fetchProgressData, error, addNotice} = useProgress();\n\tconst {fetchAllFieldsCompleted, allRequiredFieldsCompleted, fields} = useFields();\n\n    useEffect( () => {\n\t\tconst run = async () => {\n\t\t\tif ( !progressLoaded ) {\n\t\t\t\tawait fetchProgressData();\n\t\t\t}\n\t\t\tfetchAllFieldsCompleted();\n\n\t\t}\n\t\trun();\n    }, [filter, fields] );\n\n    const getStyles = () => {\n        return Object.assign(\n            {},\n            {width: percentageCompleted+\"%\"},\n        );\n    }\n\n    let progressBarColor = '';\n    if ( percentageCompleted<80 ) {\n        progressBarColor += 'cmplz-orange';\n    }\n    if ( !progressLoaded || error ) {\n        return (\n            <Placeholder lines='9' error={error}></Placeholder>\n        );\n    }\n    let noticesOutput = notices;\n    if ( filter==='remaining' ) {\n        noticesOutput = noticesOutput.filter(function (notice) {\n            return notice.status!=='completed';\n        });\n    }\n\n\tif ( !allRequiredFieldsCompleted && noticesOutput.filter(notice => notice.id==='all_fields_completed').length===0 ) {\n\t\tlet notice = {\n\t\t\tid: 'all_fields_completed',\n\t\t\tstatus: 'urgent',\n\t\t\tmessage: __( 'Not all fields have been entered, or you have not clicked the \"finish\" button yet.', 'complianz-gdpr' ),\n\t\t}\n\t\tnoticesOutput.push(notice);\n\t}\n\tif (allRequiredFieldsCompleted) {\n\t\tnoticesOutput = noticesOutput.filter(notice => notice.id!=='all_fields_completed');\n\t}\n\n\t//sorting by status\n\tnoticesOutput.sort(function(a, b) {\n\t\tif (a.status === b.status) {\n\t\t\treturn 0;\n\t\t}\n\t\telse {\n\t\t\treturn (a.status < b.status) ? 1 : -1;\n\t\t}\n\t});\n\n    return (\n        <div className=\"cmplz-progress-block\">\n            <div className=\"cmplz-progress-bar\">\n                <div className=\"cmplz-progress\">\n                    <div className={'cmplz-bar ' + progressBarColor} style={getStyles()}></div>\n                </div>\n            </div>\n\n            <div className=\"cmplz-progress-text\">\n                <h1 className=\"cmplz-progress-percentage\">\n                    {percentageCompleted}%\n                </h1>\n                <h5 className=\"cmplz-progress-text-span\">\n                    {percentageCompleted < 100 && __( 'Consent Management is activated on your site.',  'complianz-gdpr' )+' ' }\n                    {percentageCompleted< 100 && notices.length===1 && __( 'You still have 1 task open.', 'complianz-gdpr' )}\n                    {percentageCompleted<100 && notices.length>1 && __( 'You still have %s tasks open.','complianz-gdpr' ).replace('%s', notices.length) }\n\t\t\t\t\t{percentageCompleted===100  && __( 'Well done! Your website is ready for your selected regions.', 'complianz-gdpr' )}\n\n                </h5>\n            </div>\n\n            <div className=\"cmplz-scroll-container\">\n                {noticesOutput.map((notice, i) => <TaskElement key={i} notice={notice}/>)}\n            </div>\n        </div>\n    );\n\n}\nexport default ProgressBlock;\n","import { __ } from '@wordpress/i18n';\nimport Icon from '../utils/Icon'\nimport {dispatch,} from '@wordpress/data';\nimport * as rsssl_api from \"../utils/api\";\nimport sleeper from \"../utils/sleeper\";\nimport useFields from \"../Settings/Fields/FieldsData\";\nimport useProgress from \"./Progress/ProgressData\";\nimport useMenu from \"../Menu/MenuData\";\n\nconst TaskElement = (props) => {\n\tconst {dismissNotice, fetchProgressData} = useProgress();\n\tconst {getField, setHighLightField, fetchFieldsData} = useFields();\n\tconst {setSelectedSubMenuItem} = useMenu();\n\n\tconst handleClick = async () => {\n\t\tsetHighLightField(props.notice.highlight_field_id);\n\t\tlet highlightField = getField(props.notice.highlight_field_id);\n\t\tawait setSelectedSubMenuItem(highlightField.menu_id);\n\t}\n\n\tconst handleClearCache = async (cache_id) => {\n\t\tlet data = {};\n\t\tdata.cache_id = cache_id;\n\t\trsssl_api.doAction('clear_cache', data).then( async (response) => {\n\t\t\tconst notice = dispatch('core/notices').createNotice(\n\t\t\t\t'success',\n\t\t\t\t__('Re-started test', 'complianz-gdpr'),\n\t\t\t\t{\n\t\t\t\t\t__unstableHTML: true,\n\t\t\t\t\tid: 'cmplz_clear_cache',\n\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t\tisDismissible: true,\n\t\t\t\t}\n\t\t\t).then(sleeper(3000)).then((response) => {\n\t\t\t\tdispatch('core/notices').removeNotice('rsssl_clear_cache');\n\t\t\t});\n\t\t\tawait fetchFieldsData();\n\t\t\tawait fetchProgressData();\n\t\t});\n\t}\n\n\tlet notice = props.notice;\n\tlet premium = notice.icon==='premium';\n\t//treat links to complianz.io and internal links different.\n\tlet urlIsExternal = notice.url && notice.url.indexOf('complianz.io') !== -1;\n\tlet statusNice =  notice.status.charAt(0).toUpperCase() +  notice.status.slice(1);\n\treturn(\n\t\t<div className=\"cmplz-task-element\">\n\t\t\t<span className={'cmplz-task-status cmplz-' + notice.status}>{ statusNice }</span>\n\t\t\t<p className=\"cmplz-task-message\" dangerouslySetInnerHTML={{__html: notice.message}}></p>\n\t\t\t{urlIsExternal && notice.url && <a target=\"_blank\" href={notice.url}>{__(\"More info\", \"complianz-gdpr\")}</a> }\n\t\t\t{notice.clear_cache_id && <span className=\"cmplz-task-enable button button-secondary\" onClick={ () => handleClearCache(notice.clear_cache_id ) }>{__(\"Re-check\", \"complianz-gdpr\")}</span> }\n\t\t\t{!premium && !urlIsExternal && notice.url && <a className=\"cmplz-task-enable button button-secondary\" href={notice.url}>{__(\"Fix\", \"complianz-gdpr\")}</a> }\n\t\t\t{!premium && notice.highlight_field_id && <span className=\"cmplz-task-enable button button-secondary\" onClick={() => handleClick()}>{__(\"Fix\", \"complianz-gdpr\")}</span> }\n\t\t\t{notice.plusone && <span className='cmplz-plusone'>1</span>}\n\t\t\t{notice.dismissible && notice.status!=='completed' &&\n\t\t\t\t<div className=\"cmplz-task-dismiss\">\n\t\t\t\t\t<button type='button' onClick={(e) => dismissNotice(notice.id) }>\n\t\t\t\t\t\t<Icon name='times' />\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t}\n\t\t</div>\n\t);\n}\n\nexport default TaskElement;\n","/*\n * helper function to delay after a promise\n * @param ms\n * @returns {function(*): Promise<unknown>}\n */\nconst sleeper = (ms) => {\n    return function(x) {\n        return new Promise(resolve => setTimeout(() => resolve(x), ms));\n    };\n}\nexport default sleeper;"],"names":["useEffect","__","TaskElement","Placeholder","useProgress","useFields","ProgressBlock","percentageCompleted","filter","notices","progressLoaded","fetchProgressData","error","addNotice","fetchAllFieldsCompleted","allRequiredFieldsCompleted","fields","run","getStyles","Object","assign","width","progressBarColor","createElement","lines","noticesOutput","notice","status","id","length","message","push","sort","a","b","className","style","replace","map","i","key","Icon","dispatch","rsssl_api","sleeper","useMenu","props","dismissNotice","getField","setHighLightField","fetchFieldsData","setSelectedSubMenuItem","handleClick","highlight_field_id","highlightField","menu_id","handleClearCache","cache_id","data","doAction","then","response","createNotice","__unstableHTML","type","isDismissible","removeNotice","premium","icon","urlIsExternal","url","indexOf","statusNice","charAt","toUpperCase","slice","dangerouslySetInnerHTML","__html","target","href","clear_cache_id","onClick","plusone","dismissible","e","name","ms","x","Promise","resolve","setTimeout"],"sourceRoot":""}