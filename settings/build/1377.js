"use strict";(globalThis.webpackChunkcomplianz_gdpr=globalThis.webpackChunkcomplianz_gdpr||[]).push([[1377,9510],{71377:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var a=n(69307),l=n(39510),c=n(65736),o=n(43684);const i=(0,n(99196).memo)((()=>{const{documents:e,documentsLoaded:t,fetchData:i,deleteDocuments:s,editDocument:d}=(0,l.default)(),[r,u]=(0,a.useState)(""),[m]=(0,a.useState)(""),[p,g]=(0,a.useState)(""),[h,f]=(0,a.useState)([]),[_,b]=(0,a.useState)(!1),[w,E]=(0,a.useState)({}),[z,C]=(0,a.useState)(!1),[y,D]=(0,a.useState)(!1),[v,k]=(0,a.useState)(null);(0,a.useEffect)((()=>{n.e(44).then(n.bind(n,90044)).then((e=>{let{default:t}=e;k((()=>t))}))}),[]),(0,a.useEffect)((()=>{t||i()}),[t]);const L=async()=>{let t=e.filter((e=>h.includes(e.id)));b(!0),g(!0);const n=async()=>{if(t.length>0){const e=t.shift(),a=e.download_url;try{let l=new XMLHttpRequest;l.responseType="blob",l.open("get",a,!0),l.send(),l.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let n=window.URL.createObjectURL(this.response),a=window.document.createElement("a");a.setAttribute("href",n),a.setAttribute("download",e.title),window.document.body.appendChild(a),a.click(),f(t),b(!1),g(!1),setTimeout((function(){window.URL.revokeObjectURL(n)}),6e4)}},await n()}catch(e){console.error(e),g(!1)}}};await n()},S=e=>{let t=[...e];return""!==m&&(t=t.filter((e=>e.region===m))),t.sort(((e,t)=>e.title<t.title?-1:e.title>t.title?1:0)),t.filter((e=>e.title.toLowerCase().includes(r.toLowerCase())||e.service.toLowerCase().includes(r.toLowerCase()))),t},N=[{name:(0,a.createElement)("input",{type:"checkbox",className:z?"indeterminate":"",checked:y,onChange:t=>(t=>{if(t.target.checked){D(!0);let t=w.currentPage?w.currentPage:1,n=S(e).slice(5*(t-1),5*t);f(n.map((e=>e.id)))}else D(!1),f([]);C(!1)})(t)}),selector:e=>e.selectControl},{name:(0,c.__)("Document","complianz-gdpr"),selector:e=>e.title,sortable:!0},{name:(0,c.__)("Edit","complianz-gdpr"),selector:e=>e.editControl},{name:(0,c.__)("Region","complianz-gdpr"),selector:e=>(0,a.createElement)("img",{alt:"region",width:"20px",height:"20px",src:cmplz_settings.plugin_url+"assets/images/"+e.region+".svg"}),sortable:!0},{name:(0,c.__)("Service","complianz-gdpr"),selector:e=>e.service,sortable:!0},{name:(0,c.__)("Date","complianz-gdpr"),selector:e=>e.date,sortable:!0}];let R=S(e),F=[];R.forEach((t=>{let n={...t};n.selectControl=(0,a.createElement)("input",{type:"checkbox",checked:h.includes(n.id),onChange:t=>((t,n)=>{let a=t.target.checked,l=[...h];a?l.includes(n)||(l.push(n),f(l)):(l=[...h.filter((e=>e!==n))],f(l));let c=w.currentPage?w.currentPage:1,o=S(e).slice(5*(c-1),5*c),i=!0,s=!1;o.forEach((e=>{l.includes(e.id)?s=!0:i=!1})),i?(D(!0),C(!1)):s?(D(!1),C(!0)):C(!1)})(t,n.id)}),n.editControl=(0,a.createElement)("a",{href:"#",onClick:e=>d(e,n.id)},(0,c.__)("Edit","complianz-gdpr")),F.push(n)}));let P=h.length>1;return P||1!==h.length||(P=""!==e.filter((e=>h.includes(e.id)))[0].download_url),(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"cmplz-table-header"},(0,a.createElement)("div",{className:"cmplz-table-header-controls"},(0,a.createElement)("input",{className:"cmplz-datatable-search",type:"text",placeholder:(0,c.__)("Search","complianz-gdpr"),value:r,onChange:e=>u(e.target.value)}))),h.length>0&&(0,a.createElement)("div",{className:"cmplz-selected-document"},h.length>1&&(0,c.__)("%s items selected","complianz-gdpr").replace("%s",h.length),1===h.length&&(0,c.__)("1 item selected","complianz-gdpr"),(0,a.createElement)("div",{className:"cmplz-selected-document-controls"},P&&(0,a.createElement)("button",{disabled:p,className:"button button-default cmplz-btn-reset",onClick:()=>L()},(0,c.__)("Download Data Breach Report","complianz-gdpr"),_&&(0,a.createElement)(o.default,{name:"loading",color:"grey"})),!P&&(0,a.createElement)("button",{disabled:!0,className:"button button-default cmplz-btn-reset",onClick:()=>L()},(0,c.__)("Reporting not required","complianz-gdpr")),(0,a.createElement)("button",{className:"button button-default cmplz-reset-button",onClick:()=>(async e=>{f([]),await s(e)})(h)},(0,c.__)("Delete","complianz-gdpr")))),v&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(v,{columns:N,data:F,dense:!0,pagination:!0,paginationPerPage:5,onChangePage:e=>{E({...w,currentPage:e})},paginationState:w,noDataComponent:(0,a.createElement)("div",{className:"cmplz-no-documents"},(0,c.__)("No documents","complianz-gdpr")),persistTableHead:!0,theme:"really-simple-plugins",customStyles:{headCells:{style:{paddingLeft:"0",paddingRight:"0"}},cells:{style:{paddingLeft:"0",paddingRight:"0"}}}})))}))},39510:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var a=n(30270),l=n(12902),c=n(48399),o=n(75169);const i=(0,a.Ue)(((e,t)=>({documentsLoaded:!1,savedDocument:{},conclusions:[],region:"",fileName:"",fetching:!1,updating:!1,loadingFields:!1,documents:[],regions:[],fields:[],editDocumentId:!1,resetEditDocumentId:t=>{e({editDocumentId:!1,region:""})},editDocument:async(t,n)=>{t.preventDefault(),e({updating:!0}),await c.doAction("load_databreach_report",{id:n}).then((t=>{e({fields:t.fields,region:t.region,updating:!1,fileName:t.file_name})})).catch((e=>{console.error(e)})),e({editDocumentId:n})},setRegion:t=>{e({region:t})},updateField:(n,a)=>{let c=!1,i=!1;e((0,l.ZP)((e=>{e.fields.forEach((function(e,t){e.id===n&&(i=t,c=!0)})),!1!==i&&(e.fields[i].value=a)})));let s=(0,o.updateFieldsListWithConditions)(t().fields);e({fields:s})},save:async n=>{e({updating:!0});let a=t().editDocumentId,l=0;await c.doAction("save_databreach_report",{fields:t().fields,region:n,post_id:a}).then((t=>(l=t.post_id,e({updating:!1,conclusions:t.conclusions}),t))).catch((e=>{console.error(e)})),await t().fetchData();let o=t().documents.filter((e=>e.id===l));o.length>0&&e({savedDocument:o[0]})},deleteDocuments:async n=>{let a=t().documents.filter((e=>n.includes(e.id)));e((e=>({documents:e.documents.filter((e=>!n.includes(e.id)))})));let l={};l.documents=a,await c.doAction("delete_databreach_report",l).then((e=>e)).catch((e=>{console.error(e)}))},fetchData:async()=>{if(t().fetching)return;e({fetching:!0});const{documents:n,regions:a}=await c.doAction("get_databreach_reports",{}).then((e=>e)).catch((e=>{console.error(e)}));e((e=>({documentsLoaded:!0,documents:n,regions:a,fetching:!1})))},fetchFields:async t=>{let n={region:t};e({loadingFields:!0});const{fields:a}=await c.doAction("get_databreach_report_fields",n).then((e=>e)).catch((e=>{console.error(e)}));let l=(0,o.updateFieldsListWithConditions)(a);e((e=>({fields:l,loadingFields:!1})))}})))}}]);