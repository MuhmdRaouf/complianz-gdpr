"use strict";(self.webpackChunkcomplianz_gdpr=self.webpackChunkcomplianz_gdpr||[]).push([[1143,9511],{61143:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var a=n(69307),o=n(65736),l=n(9511);const s=(0,n(99196).memo)((()=>{const{documents:e,downloadUrl:t,deleteDocuments:s,documentsLoaded:c,fetchData:r}=(0,l.default)(),[i,d]=(0,a.useState)(""),[m,u]=(0,a.useState)([]),g=!cmplz_settings.is_premium,[p,f]=(0,a.useState)({}),[h,_]=(0,a.useState)(!1),[w,b]=(0,a.useState)(!1),[z,E]=(0,a.useState)(null);(0,a.useEffect)((()=>{n.e(44).then(n.bind(n,90044)).then((e=>{let{default:t}=e;E((()=>t))}))}),[]),(0,a.useEffect)((()=>{c||r()}),[c]);const y=async()=>{let n=e.filter((e=>m.includes(e.id)));u([]);const a=async()=>{if(n.length>0){const e=n.shift(),o=t+"/"+e.file;d(!0);try{let t=new XMLHttpRequest;t.responseType="blob",t.open("get",o,!0),t.send(),t.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let t=window.URL.createObjectURL(this.response),n=window.document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",e.filename),window.document.body.appendChild(n),n.click(),setTimeout((function(){window.URL.revokeObjectURL(t)}),6e4)}},await a()}catch(e){console.error(e),d(!1)}}};await a(),d(!1)},C=e=>(e.sort(((e,t)=>e.file<t.file?-1:e.file>t.file?1:0)),e),v=[{name:(0,a.createElement)(CheckboxGroup,{options:{true:""},className:h?"indeterminate":"",value:w,onChange:t=>(t=>{if(t){b(!0);let t=p.currentPage?p.currentPage:1,n=C(e).slice(10*(t-1),10*t);u(n.map((e=>e.id)))}else b(!1),u([]);_(!1)})(t)}),selector:e=>e.selectControl,grow:1,minWidth:"50px"},{name:(0,o.__)("Document","complianz-gdpr"),selector:e=>e.file,sortable:!0,grow:6},{name:(0,o.__)("Region","complianz-gdpr"),selector:e=>(0,a.createElement)("img",{alt:"region",width:"20px",height:"20px",src:cmplz_settings.plugin_url+"assets/images/"+e.region+".svg"}),sortable:!0,grow:2,right:!0},{name:(0,o.__)("Consent","complianz-gdpr"),selector:e=>e.consent,sortable:!0,grow:2,right:!0},{name:(0,o.__)("Date","complianz-gdpr"),selector:e=>e.time,sortable:!0,grow:4,right:!0}];let k=[...e];k=C(k);let D=[];return k.forEach((t=>{let n={...t};n.selectControl=(0,a.createElement)(CheckboxGroup,{value:m.includes(n.id),options:{true:""},onChange:t=>((t,n)=>{let a=[...m];t?a.includes(n)||(a.push(n),u(a)):(a=[...m.filter((e=>e!==n))],u(a));let o=p.currentPage?p.currentPage:1,l=C(e).slice(10*(o-1),10*o),s=!0,c=!1;l.forEach((e=>{a.includes(e.id)?c=!0:s=!1})),s?(b(!0),_(!1)):c?(b(!1),_(!0)):_(!1)})(!m.includes(n.id),n.id)}),D.push(n)})),(0,a.createElement)(a.Fragment,null,g&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"cmplz-settings-overlay"},(0,a.createElement)("div",{className:"cmplz-settings-overlay-message"}))),m.length>0&&(0,a.createElement)("div",{className:"cmplz-selected-document"},m.length>1&&(0,o.__)("%s items selected","complianz-gdpr").replace("%s",m.length),1===m.length&&(0,o.__)("1 item selected","complianz-gdpr"),(0,a.createElement)("div",{className:"cmplz-selected-document-controls"},(0,a.createElement)("button",{disabled:i,className:"button button-default cmplz-btn-reset",onClick:()=>y()},(0,o.__)("Download Proof of Consent","complianz-gdpr")),(0,a.createElement)("button",{className:"button button-default cmplz-reset-button",onClick:()=>(async e=>{u([]),await s(e)})(m)},(0,o.__)("Delete","complianz-gdpr")))),!g&&z&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(z,{className:"cmplz-data-table",columns:v,data:D,dense:!0,pagination:!0,paginationPerPage:10,onChangePage:e=>{f({...p,currentPage:e})},paginationState:p,noDataComponent:(0,a.createElement)("div",{className:"cmplz-no-documents"},(0,o.__)("No documents","really-simple-ssl")),persistTableHead:!0,theme:"really-simple-plugins",customStyles:{headCells:{style:{paddingLeft:"0",paddingRight:"0"}},cells:{style:{paddingLeft:"0",paddingRight:"0"}}}})))}))},9511:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var a=n(30270),o=n(48399);const l=(0,a.Ue)(((e,t)=>({documentsLoaded:!1,fetching:!1,generating:!1,documents:[],downloadUrl:"",regions:[],fields:[],deleteDocuments:async n=>{let a=t().documents.filter((e=>n.includes(e.id)));e((e=>({documents:e.documents.filter((e=>!n.includes(e.id)))})));let l={};l.documents=a,await o.doAction("delete_proof_of_consent_documents",l).then((e=>e)).catch((e=>{console.error(e)}))},generateProofOfConsent:async()=>{e({generating:!0}),await o.doAction("generate_proof_of_consent",{}).then((e=>e)).catch((e=>{console.error(e)})),await t().fetchData(),e({generating:!1})},fetchData:async()=>{if(t().fetching)return;e({fetching:!0});const{documents:n,regions:a,download_url:l}=await o.doAction("get_proof_of_consent_documents",{}).then((e=>e)).catch((e=>{console.error(e)}));e((e=>({documentsLoaded:!0,documents:n,regions:a,downloadUrl:l,fetching:!1})))}})))}}]);