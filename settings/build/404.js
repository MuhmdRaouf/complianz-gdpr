"use strict";(globalThis.webpackChunkcomplianz_gdpr=globalThis.webpackChunkcomplianz_gdpr||[]).push([[404,7853],{80404:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var a=n(69307),l=n(17853),c=n(65736),i=n(43684);const s=(0,n(99196).memo)((()=>{const{documents:e,documentsLoaded:t,fetchData:s,deleteDocuments:o,editDocument:d}=(0,l.default)(),[r,m]=(0,a.useState)(""),[u,g]=(0,a.useState)({}),[p,h]=(0,a.useState)(!1),[f,_]=(0,a.useState)(!1),[b,w]=(0,a.useState)(""),[v,E]=(0,a.useState)([]),[z,y]=(0,a.useState)(!1),[C,N]=(0,a.useState)(null);(0,a.useEffect)((()=>{n.e(44).then(n.bind(n,90044)).then((e=>{let{default:t}=e;N((()=>t))}))}),[]),cmplz_settings.is_premium,(0,a.useEffect)((()=>{t||s()}),[t]);const D=async()=>{let t=e.filter((e=>v.includes(e.id)));y(!0);const n=async()=>{if(t.length>0){const e=t.shift(),a=e.download_url;w(!0);try{let l=new XMLHttpRequest;l.responseType="blob",l.open("get",a,!0),l.send(),l.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let n=window.URL.createObjectURL(this.response),a=window.document.createElement("a");a.setAttribute("href",n),a.setAttribute("download",e.title),window.document.body.appendChild(a),a.click(),E(t),y(!1),setTimeout((function(){window.URL.revokeObjectURL(n)}),6e4)}},await n()}catch(e){console.error(e),w(!1)}}};await n(),w(!1)},L=e=>((e=e.filter((e=>e.title.toLowerCase().includes(r.toLowerCase())||e.service.toLowerCase().includes(r.toLowerCase())))).sort(((e,t)=>e.title<t.title?-1:e.title>t.title?1:0)),e),k=[{name:(0,a.createElement)("input",{type:"checkbox",className:p?"indeterminate":"",checked:f,onChange:t=>(t=>{if(t.target.checked){_(!0);let t=u.currentPage?u.currentPage:1,n=L(e).slice(5*(t-1),5*t);E(n.map((e=>e.id)))}else _(!1),E([]);h(!1)})(t)}),selector:e=>e.selectControl},{name:(0,c.__)("Document","complianz-gdpr"),selector:e=>e.title,sortable:!0},{name:(0,c.__)("Edit","complianz-gdpr"),selector:e=>e.editControl},{name:(0,c.__)("Region","complianz-gdpr"),selector:e=>(0,a.createElement)("img",{alt:"region",width:"20px",height:"20px",src:cmplz_settings.plugin_url+"assets/images/"+e.region+".svg"}),sortable:!0},{name:(0,c.__)("Service","complianz-gdpr"),selector:e=>e.service,sortable:!0},{name:(0,c.__)("Date","complianz-gdpr"),selector:e=>e.date,sortable:!0}];let S=L(e),P=[];return S.forEach((t=>{let n={...t};n.selectControl=(0,a.createElement)("input",{type:"checkbox",checked:v.includes(n.id),onChange:t=>((t,n)=>{let a=t.target.checked,l=[...v];a?l.includes(n)||(l.push(n),E(l)):(l=[...v.filter((e=>e!==n))],E(l));let c=u.currentPage?u.currentPage:1,i=L(e).slice(5*(c-1),5*c),s=!0,o=!1;i.forEach((e=>{l.includes(e.id)?o=!0:s=!1})),s?(_(!0),h(!1)):o?(_(!1),h(!0)):h(!1)})(t,n.id)}),n.editControl=(0,a.createElement)("a",{href:"#",onClick:e=>d(e,n.id)},(0,c.__)("Edit","complianz-gdpr")),P.push(n)})),(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"cmplz-table-header"},(0,a.createElement)("div",{className:"cmplz-table-header-controls"},(0,a.createElement)("input",{className:"cmplz-datatable-search",type:"text",placeholder:(0,c.__)("Search","complianz-gdpr"),value:r,onChange:e=>m(e.target.value)}))),v.length>0&&(0,a.createElement)("div",{className:"cmplz-selected-document"},v.length>1&&(0,c.__)("%s items selected","complianz-gdpr").replace("%s",v.length),1===v.length&&(0,c.__)("1 item selected","complianz-gdpr"),(0,a.createElement)("div",{className:"cmplz-selected-document-controls"},(0,a.createElement)("button",{disabled:b,className:"button button-default cmplz-btn-reset",onClick:()=>D()},(0,c.__)("Download Processing Agreement","complianz-gdpr"),z&&(0,a.createElement)(i.default,{name:"loading",color:"grey"})),(0,a.createElement)("button",{className:"button button-default cmplz-reset-button",onClick:()=>(async e=>{E([]),await o(e)})(v)},(0,c.__)("Delete","complianz-gdpr")))),C&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(C,{columns:k,data:P,dense:!0,pagination:!0,noDataComponent:(0,a.createElement)("div",{className:"cmplz-no-documents"},(0,c.__)("No documents","really-simple-ssl")),persistTableHead:!0,theme:"really-simple-plugins",customStyles:{headCells:{style:{paddingLeft:"0",paddingRight:"0"}},cells:{style:{paddingLeft:"0",paddingRight:"0"}}},paginationPerPage:5,onChangePage:e=>{g({...u,currentPage:e})},paginationState:u})))}))},17853:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var a=n(30270),l=n(12902),c=n(48399),i=n(75169);const s=(0,a.Ue)(((e,t)=>({documentsLoaded:!1,region:"",fileName:"",serviceName:"",fetching:!1,updating:!1,loadingFields:!1,documents:[],regions:[],fields:[],editDocumentId:!1,resetEditDocumentId:t=>{e({editDocumentId:!1,region:"",serviceName:""})},editDocument:async(t,n)=>{t.preventDefault(),e({updating:!0}),await c.doAction("load_processing_agreement",{id:n}).then((t=>{e({fields:t.fields,region:t.region,serviceName:t.serviceName,updating:!1,fileName:t.file_name})})).catch((e=>{console.error(e)})),e({editDocumentId:n})},setRegion:t=>{e({region:t})},setServiceName:t=>{e({serviceName:t})},updateField:(n,a)=>{let c=!1,s=!1;e((0,l.ZP)((e=>{e.fields.forEach((function(e,t){e.id===n&&(s=t,c=!0)})),!1!==s&&(e.fields[s].value=a)})));let o=(0,i.updateFieldsListWithConditions)(t().fields);e({fields:o})},save:async(n,a)=>{e({updating:!0});let l=t().editDocumentId;await c.doAction("save_processing_agreement",{fields:t().fields,region:n,serviceName:a,post_id:l}).then((t=>(e({updating:!1}),t))).catch((e=>{console.error(e)})),t().fetchData()},deleteDocuments:async n=>{let a=t().documents.filter((e=>n.includes(e.id)));e((e=>({documents:e.documents.filter((e=>!n.includes(e.id)))})));let l={};l.documents=a,await c.doAction("delete_processing_agreement",l).then((e=>e)).catch((e=>{console.error(e)}))},fetchData:async()=>{if(t().fetching)return;e({fetching:!0});const{documents:n,regions:a}=await c.doAction("get_processing_agreements",{}).then((e=>e)).catch((e=>{console.error(e)}));e((()=>({documentsLoaded:!0,documents:n,regions:a,fetching:!1})))},fetchFields:async t=>{let n={region:t};e({loadingFields:!0});const{fields:a}=await c.doAction("get_processing_agreement_fields",n).then((e=>e)).catch((e=>{console.error(e)}));let l=(0,i.updateFieldsListWithConditions)(a);e((e=>({fields:l,loadingFields:!1})))}})))}}]);