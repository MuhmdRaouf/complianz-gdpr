{"version":3,"file":"src_Settings_InstallPlugin_InstallPlugin_js.js","mappings":"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","sources":["webpack://complianz-gdpr/./src/Settings/InstallPlugin/InstallPlugin.js","webpack://complianz-gdpr/./src/Settings/InstallPlugin/InstallPluginData.js"],"sourcesContent":["import {useEffect} from \"@wordpress/element\";\nimport Icon from \"../../utils/Icon\";\nimport {__} from '@wordpress/i18n';\nimport useInstallPluginData from \"./InstallPluginData\";\nimport {memo} from \"react\";\n\nconst InstallPlugin = ( {field} ) => {\n\tconst {statusLoaded, startPluginAction, apiRequestActive, pluginAction, rating} = useInstallPluginData();\n\tconst slug = field.plugin_data.slug;\n\tconst title = field.plugin_data.title;\n\tconst summary = field.plugin_data.summary;\n\tconst description = field.plugin_data.description;\n\tconst image = field.plugin_data.image;\n\n    useEffect(() => {\n    \t//get initial data\n\t\tif (!statusLoaded) {\n\t\t\tstartPluginAction(slug);\n\t\t}\n    }, [])\n\n\tconst onClickHandler = () => {\n\t\tstartPluginAction(slug);\n\t}\n\n\tconst wpStarRating = () => {\n\n\t\t// Calculate the number of each type of star needed.\n\t\tlet fullStars  = Math.floor( rating );\n\t\tlet halfStars  = Math.ceil( rating - fullStars );\n\t\tlet emptyStars = 5 - fullStars - halfStars;\n\t\tfullStars = createArrayFromInt(fullStars);\n\t\thalfStars = createArrayFromInt(halfStars);\n\t\temptyStars = createArrayFromInt(emptyStars);\n\t\treturn (\n\t\t\t<div className=\"star-rating\">\n\t\t\t\t<span className=\"screen-reader-text\">{__('%s rating based on %d ratings', 'complianz-gdpr').replace('%s', '5').replace('%d', '84')}</span>\n\t\t\t\t{ fullStars.map((star, i) => <div key={i} className=\"star star-full\" aria-hidden=\"true\"></div> ) }\n\t\t\t\t{ halfStars.map((star, i) => <div key={i} className=\"star star-half\" aria-hidden=\"true\"></div> ) }\n\t\t\t\t{ emptyStars.map((star, i) => <div key={i} className=\"star star-empty\" aria-hidden=\"true\"></div> ) }\n\t\t\t</div>\n\t\t)\n\t}\n\n\tconst createArrayFromInt = (n) => {\n      let arr = [];\n      for (let i = 1; i <= n; i++) {\n        arr.push(i);\n      }\n      return arr;\n    }\n\n\tlet disabled = apiRequestActive;\n\tlet installed = pluginAction==='installed';\n\tlet buttonString = '';\n\n\tswitch(pluginAction) {\n      case 'upgrade-to-premium':\n        buttonString = __(\"Upgrade\",\"complianz-gdpr\");\n        break;\n      case 'activate':\n        buttonString = apiRequestActive ? __(\"Activating\", \"complianz-gdpr\") : __(\"Activate\",\"complianz-gdpr\");\n        break;\n\t  case 'download':\n\t\tbuttonString = apiRequestActive ? __(\"Installing\", \"complianz-gdpr\") : __(\"Install\",\"complianz-gdpr\");\n\t\tbreak;\n      default:\n      \tdisabled = true;\n        buttonString = __(\"Installed\",\"complianz-gdpr\");\n    }\n\n\n\n\treturn (\n\t\t<div className=\"cmplz-suggested-plugin\">\n\t\t\t<img className=\"cmplz-suggested-plugin-img\" src={cmplz_settings.plugin_url+'/upgrade/img/'+image} />\n\t\t\t<div className=\"cmplz-suggested-plugin-group\">\n\t\t\t\t<div className=\"cmplz-suggested-plugin-group-title\">{title}</div>\n\t\t\t\t<div className=\"cmplz-suggested-plugin-group-desc\">{summary}</div>\n\t\t\t\t<div className=\"cmplz-suggested-plugin-group-rating\">\n\t\t\t\t{wpStarRating()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"cmplz-suggested-plugin-desc-long\">\n\t\t\t\t{ description }\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={ ( e ) => onClickHandler(e) } className=\"button-secondary cmplz-install-plugin\">\n\t\t\t\t\t{ buttonString }\n\t\t\t\t\t{ apiRequestActive && <Icon name = \"loading\" color = 'grey' /> }\n\t\t\t\t</button>\n\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n\nexport default memo(InstallPlugin)\n","import {create} from 'zustand';\nimport * as cmplz_api from \"../../utils/api\";\nconst UseInstallPluginData = create(( set, get ) => ({\n\tapiRequestActive:false,\n\tpluginAction: 'status',\n\twordPressUrl: '#',\n\trating: [],\n\tstatusLoaded:false,\n\tstartPluginAction: (slug, action) => {\n\t\tlet data = {};\n\t\tset({apiRequestActive:true});\n\t\tdata.pluginAction = typeof action !== 'undefined' ? action : get().pluginAction;\n\t\tdata.slug = slug;\n\t\tlet nextAction = false;\n\t\tif (data.pluginAction === 'download') {\n\t\t\tnextAction = 'activate';\n\t\t}\n\t\tcmplz_api.doAction('plugin_actions', data).then( ( response ) => {\n\t\t\tset({\n\t\t\t\tpluginAction:response.pluginAction,\n\t\t\t\twordPressUrl:response.wordpress_url,\n\t\t\t});//'installed', 'download', 'activate', 'upgrade-to-premium'\n\n\t\t\t//convert to percentage\n\t\t\tlet p = Math.round( response.star_rating.rating / 10, 0 ) / 2;\n\t\t\tset({\n\t\t\t\trating:p,\n\t\t\t\tratingCount:response.star_rating.rating_count,\n\t\t\t\tapiRequestActive:false,\n\t\t\t\tstatusLoaded:true,\n\t\t\t});\n\t\t\t//if the plugin is installed, go ahead and activate as well\n\t\t\tif (nextAction === 'activate' && response.pluginAction!=='installed' ) {\n\t\t\t\tget().startPluginAction(response.pluginAction);\n\t\t\t}\n\n\t\t});\n\t},\n}));\n\nexport default UseInstallPluginData;\n\n"],"names":["useEffect","Icon","__","useInstallPluginData","memo","InstallPlugin","_ref","field","statusLoaded","startPluginAction","apiRequestActive","pluginAction","rating","slug","plugin_data","title","summary","description","image","onClickHandler","wpStarRating","fullStars","Math","floor","halfStars","ceil","emptyStars","createArrayFromInt","createElement","className","replace","map","star","i","key","n","arr","push","disabled","installed","buttonString","src","cmplz_settings","plugin_url","type","onClick","e","name","color","create","cmplz_api","UseInstallPluginData","set","get","wordPressUrl","action","data","nextAction","doAction","then","response","wordpress_url","p","round","star_rating","ratingCount","rating_count"],"sourceRoot":""}