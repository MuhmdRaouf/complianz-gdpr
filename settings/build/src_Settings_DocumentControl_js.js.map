{"version":3,"file":"src_Settings_DocumentControl_js.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAA6C;AACR;AACK;AACqB;AACrB;AACT;AACJ;AACe;AAE5C,MAAMU,eAAe,GAAGC,IAAA,IAAkD;EAAA,IAAjD;IAACC,EAAE;IAAEC,KAAK;IAAEC,OAAO;IAAEC,YAAY;IAAEC;EAAQ,CAAC,GAAAL,IAAA;EACjE,MAAM,CAACM,MAAM,EAAEC,SAAS,CAAC,GAAGf,4DAAQ,CAAC,KAAK,CAAC;EAC3C,MAAM,CAACgB,OAAO,EAAEC,UAAU,CAAC,GAAGjB,4DAAQ,CAAC,EAAE,CAAC;EAC1C,MAAM,CAACkB,KAAK,EAAEC,QAAQ,CAAC,GAAGnB,4DAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACoB,eAAe,EAAEC,kBAAkB,CAAC,GAAGrB,4DAAQ,CAAC,KAAK,CAAC;EAC7D,MAAM,CAACsB,aAAa,EAAEC,gBAAgB,CAAC,GAAGvB,4DAAQ,CAAC,KAAK,CAAC;EACzD,MAAM,CAACwB,KAAK,EAAEC,QAAQ,CAAC,GAAGzB,4DAAQ,CAAC,IAAI,CAAC;EAC3C,MAAM0B,WAAW,GAAGxB,0DAAM,CAACQ,KAAK,CAAC;EACjC,MAAM;IAACiB,WAAW;IAAEC;EAAe,CAAC,GAAGtB,8DAAS,CAAC,CAAC;EAElD,MAAMuB,aAAa,GAAIC,MAAM,IAAK;IACjC,IAAIC,QAAQ,GAAIL,WAAW,CAACM,OAAO,KAAKtB,KAAK,IAAKoB,MAAM;IACxD,IAAKpB,KAAK,KAAG,QAAQ,IAAI,CAACU,eAAe,EAAG;MAC3CM,WAAW,CAACM,OAAO,GAAGtB,KAAK;MAC3B,IAAIqB,QAAQ,EAAEE,WAAW,CAAC,KAAK,CAAC;IACjC;IAEA,IAAKvB,KAAK,KAAG,KAAK,IAAI,CAACY,aAAa,EAAE;MACrC,IAAIY,IAAI,GAAG,CAAC,CAAC;MACbR,WAAW,CAACM,OAAO,GAAGtB,KAAK;MAC3BwB,IAAI,CAACC,IAAI,GAAG1B,EAAE;MACdV,gDAAkB,CAAC,+BAA+B,EAAEmC,IAAI,CAAC,CAACG,IAAI,CAAIC,QAAQ,IAAM;QAC/ErB,UAAU,CAACqB,QAAQ,CAACtB,OAAO,CAAC;QAC5BO,gBAAgB,CAAC,IAAI,CAAC;MACvB,CAAC,CAAC;IACH;EACD,CAAC;EAEDtB,6DAAS,CAAE,MAAM;IAChB,IAAIsC,MAAM,GAAG5B,OAAO,CAAC6B,GAAG,CAACC,MAAM,IAAIA,MAAM,CAAC/B,KAAK,CAAC;IAC7C,IAAK,CAAC6B,MAAM,CAACG,QAAQ,CAAChC,KAAK,CAAC,EAAG;MAC9B;MACAiB,WAAW,CAAClB,EAAE,EAAEG,YAAY,CAAC;IAC9B;IACHiB,aAAa,CAAC,IAAI,CAAC;EACpB,CAAC,EAAE,EAAE,CAAC;EAEN1B,qDAAe,CAAE,MAAM;IACtB0B,aAAa,CAAC,KAAK,CAAC;EACrB,CAAC,CAAC;EAEF,MAAMI,WAAW,GAAIU,MAAM,IAAK;IAC/B,IAAIT,IAAI,GAAG,CAAC,CAAC;IACbA,IAAI,CAACC,IAAI,GAAG1B,EAAE;IACdyB,IAAI,CAACS,MAAM,GAAGA,MAAM;IACpB,OAAO5C,gDAAkB,CAAC,gBAAgB,EAAEmC,IAAI,CAAC,CAACG,IAAI,CAAIC,QAAQ,IAAM;MACvE;MACA,IAAIM,YAAY,GAAGN,QAAQ,CAACpB,KAAK,CAAC2B,MAAM,CAAC,UAAUC,OAAO,EAAE;QAC3D,OAAOA,OAAO,CAACpC,KAAK,KAAK4B,QAAQ,CAACxB,MAAM;MACzC,CAAC,CAAC;MACFC,SAAS,CAAC6B,YAAY,CAAC;MACvBvB,kBAAkB,CAAC,IAAI,CAAC;MACxBF,QAAQ,CAACmB,QAAQ,CAACpB,KAAK,CAAC;MACxB,OAAOoB,QAAQ,CAACpB,KAAK;IACtB,CAAC,CAAC;EACH,CAAC;EAED,MAAM6B,eAAe,GAAIrC,KAAK,IAAK;IAC5BiB,WAAW,CAAClB,EAAE,EAAEC,KAAK,CAAC;IACtBkB,eAAe,CAACnB,EAAE,EAAEC,KAAK,CAAC;EAC9B,CAAC;EAED,MAAMsC,YAAY,GAAIC,UAAU,IAC9B,IAAIC,OAAO,CAAGC,OAAO,IAAK;IAC5BC,UAAU,CAAC,MAAM;MACVD,OAAO,CAAClB,WAAW,CAACgB,UAAU,CAAC,CAAC;IACvC,CAAC,EAAE,IAAI,CAAC;EACR,CAAC,CAAC;EAEL,MAAMI,qBAAqB,GAAIP,OAAO,IAAK;IAC1C,IAAIZ,IAAI,GAAG,CAAC,CAAC;IACbA,IAAI,CAACpB,MAAM,GAAGgC,OAAO,CAACpC,KAAK;IAC3BwB,IAAI,CAACC,IAAI,GAAG1B,EAAE;IACdM,SAAS,CAAC+B,OAAO,CAAC;IAClB/C,gDAAkB,CAAC,iCAAiC,EAAEmC,IAAI,CAAC,CAACG,IAAI,CAAIC,QAAQ,IAAM,CAAC,CAAC,CAAC;EACnF,CAAC;;EAEJ;AACD;AACA;EACC,MAAMgB,kBAAkB,GAAIC,CAAC,IAAK;IACjC,IAAIrB,IAAI,GAAG,CAAC,CAAC;IACb,IAAIxB,KAAK,GAAG6C,CAAC,CAACC,MAAM,CAAC9C,KAAK;IAC1BwB,IAAI,CAAClB,OAAO,GAAGN,KAAK;IACpBwB,IAAI,CAACC,IAAI,GAAG1B,EAAE;IACdQ,UAAU,CAACP,KAAK,CAAC;IACX+C,YAAY,CAACjC,KAAK,CAAC;IACnB,MAAMkC,QAAQ,GAAGN,UAAU,CAAC,MAAM;MACvCrD,gDAAkB,CAAC,kCAAkC,EAAEmC,IAAI,CAAC,CAACG,IAAI,CAAIC,QAAQ,IAAM,CAAC,CAAC,CAAC;IACjF,CAAC,EAAE,GAAG,CAAC;IAEPb,QAAQ,CAACiC,QAAQ,CAAC;EACzB,CAAC;EAED,OACCC,iEAAA,CAAAC,wDAAA,QAEEjD,OAAO,CAAC6B,GAAG,CAAC,CAACC,MAAM,EAAEoB,CAAC,KACrBF,iEAAA;IAAKG,GAAG,EAAE,YAAY,GAACD,CAAE;IAACE,SAAS,EAAC;EAAkC,GACrEJ,iEAAA;IAAOxB,IAAI,EAAC,OAAO;IAACtB,QAAQ,EAAEmD,KAAK,CAACC,OAAO,CAACpD,QAAQ,CAAC,IAAIA,QAAQ,CAACqD,OAAO,CAACzB,MAAM,CAAC/B,KAAK,CAAC,IAAI,CAAC,CAAE;IAACyD,OAAO,EAAIzD,KAAK,IAAE+B,MAAM,CAAC/B,KAAM;IAACoD,GAAG,EAAED,CAAE;IAACO,KAAK,EAAEP,CAAE;IAACQ,QAAQ,EAAKd,CAAC,IAAMR,eAAe,CAACN,MAAM,CAAC/B,KAAK;EAAG,CAAE,CAAC,EACvMiD,iEAAA;IAAOG,GAAG,EAAE,QAAQ,GAACD,CAAE;IAACS,OAAO,EAAE7B,MAAM,CAAC/B,KAAM;IAAC0D,KAAK,EAAEP;EAAE,GAAEpB,MAAM,CAAC8B,KAAa,CAC1E,CACN,CAAC,EAEA7D,KAAK,KAAG,QAAQ,IAAI,CAACU,eAAe,IACrCuC,iEAAA;IAAKI,SAAS,EAAC;EAAwB,GACtCJ,iEAAA,cAAKA,iEAAA,CAACvD,mDAAI;IAACoE,IAAI,EAAG,SAAS;IAACC,KAAK,EAAG;EAAM,CAAE,CAAM,CAAC,EAAAd,iEAAA,cAAM7D,mDAAE,CAAC,YAAY,EAAE,gBAAgB,CAAO,CAC7F,CAAC,EAELY,KAAK,KAAG,QAAQ,IAAIU,eAAe,IACpCuC,iEAAA,CAAAC,wDAAA,QACeD,iEAAA,CAAC9D,0DAAW;IACvB0E,KAAK,EAAGzE,mDAAE,CAAC,qBAAqB,EAAE,gBAAgB,CAAG;IACnC4E,cAAc,EAAExD,KAAM;IACtBe,WAAW,EAAEe,YAAa;IAC5C2B,gBAAgB,EAAEC,QAAQ,CAACC,IAAK;IAChCC,YAAY,EAAE,OAAQ;IACtBC,WAAW,EAAEjF,mDAAE,CAAC,8BAA8B,CAAE;IAChDuE,QAAQ,EAAKW,UAAU,IAAM3B,qBAAqB,CAAC2B,UAAU,CAAG;IAChEtE,KAAK,EAAII;EAAQ,CACA,CAGnB,CAAC,EAEFJ,KAAK,KAAG,KAAK,IAAI,CAACY,aAAa,IAChCqC,iEAAA;IAAKI,SAAS,EAAC;EAAwB,GACtCJ,iEAAA,cAAKA,iEAAA,CAACvD,mDAAI;IAACoE,IAAI,EAAG,SAAS;IAACC,KAAK,EAAG;EAAM,CAAE,CAAM,CAAC,EAAAd,iEAAA,cAAM7D,mDAAE,CAAC,YAAY,EAAE,gBAAgB,CAAO,CAC7F,CAAC,EAELY,KAAK,KAAG,KAAK,IAAIY,aAAa,IAC/BqC,iEAAA,CAAAC,wDAAA,QAAED,iEAAA;IAAOxB,IAAI,EAAC,MAAM;IAACzB,KAAK,EAAEM,OAAQ;IAACqD,QAAQ,EAAEf,kBAAmB;IAACyB,WAAW,EAAC;EAAgC,CAAC,CAAG,CAEnH,CAAC;AAEL,CAAC;AACD,iEAAe1E,2CAAI,CAACE,eAAe,CAAC","sources":["webpack://complianz-gdpr/./src/Settings/DocumentControl.js"],"sourcesContent":["import AsyncSelect from 'react-select/async';\nimport { __ } from '@wordpress/i18n';\nimport * as cmplz_api from \"../utils/api\";\nimport {useState, useEffect, useRef} from \"@wordpress/element\";\nimport {useUpdateEffect} from 'react-use';\nimport Icon from \"../utils/Icon\";\nimport { memo } from 'react';\nimport useFields from \"./Fields/FieldsData\";\n\nconst DocumentControl = ({id, value, options, defaultValue, disabled}) => {\n    const [pageId, setPageId] = useState(false);\n    const [pageUrl, setPageUrl] = useState('');\n    const [pages, setPages] = useState([]);\n    const [pagesListLoaded, setPagesListLoaded] = useState(false);\n    const [pageUrlLoaded, setPageUrlLoaded] = useState(false);\n    const [timer, setTimer] = useState(null)\n\tconst currentType = useRef(value);\n\tconst {updateField, setChangedField} = useFields();\n\n\tconst loadSubFields = (onLoad) => {\n\t\tlet loadData = (currentType.current !== value) || onLoad;\n\t\tif ( value==='custom' && !pagesListLoaded ) {\n\t\t\tcurrentType.current = value\n\t\t\tif (loadData) loadOptions(false);\n\t\t}\n\n\t\tif ( value==='url' && !pageUrlLoaded) {\n\t\t\tlet data = {};\n\t\t\tcurrentType.current = value\n\t\t\tdata.type = id;\n\t\t\tcmplz_api.doAction('get_custom_legal_document_url', data).then( ( response ) => {\n\t\t\t\tsetPageUrl(response.pageUrl);\n\t\t\t\tsetPageUrlLoaded(true);\n\t\t\t});\n\t\t}\n\t}\n\n\tuseEffect( () => {\n\t\tlet values = options.map(option => option.value);\n    \tif ( !values.includes(value) ) {\n    \t\t//we need to save it in the page props, otherwise it's not seen by the conditions validator\n    \t\tupdateField(id, defaultValue);\n    \t}\n\t\tloadSubFields(true);\n\t}, [])\n\n\tuseUpdateEffect( () => {\n\t\tloadSubFields(false);\n\t})\n\n\tconst loadOptions = (search) => {\n\t\tlet data = {};\n\t\tdata.type = id;\n\t\tdata.search = search;\n\t\treturn cmplz_api.doAction('get_pages_list', data).then( ( response ) => {\n\t\t\t//get option from pages pages list\n\t\t\tlet selectedPage = response.pages.filter(function (element) {\n\t\t\t\treturn element.value === response.pageId;\n\t\t\t});\n\t\t\tsetPageId(selectedPage);\n\t\t\tsetPagesListLoaded(true);\n\t\t\tsetPages(response.pages);\n\t\t\treturn response.pages;\n\t\t});\n\t}\n\n\tconst onChangeHandler = (value) => {\n        updateField(id, value);\n        setChangedField(id, value);\n    }\n\n    const promisePages = (inputValue) =>\n      new Promise( (resolve) => {\n\t\t  setTimeout(() => {\n          \tresolve(loadOptions(inputValue));\n\t\t  }, 1000);\n    });\n\n\tconst onChangeSelectHandler = (element) => {\n\t\tlet data = {};\n\t\tdata.pageId = element.value;\n\t\tdata.type = id;\n\t\tsetPageId(element);\n\t\tcmplz_api.doAction('update_custom_legal_document_id', data).then( ( response ) => {});\n    }\n\n\t/*\n\t* Only call api if user stops typing, after 500 ms.\n\t*/\n\tconst onChangeUrlHandler = (e) => {\n\t\tlet data = {};\n\t\tlet value = e.target.value;\n\t\tdata.pageUrl = value;\n\t\tdata.type = id;\n\t\tsetPageUrl(value);\n        clearTimeout(timer)\n        const newTimer = setTimeout(() => {\n\t\t\tcmplz_api.doAction('update_custom_legal_document_url', data).then( ( response ) => {});\n        }, 500)\n\n        setTimer(newTimer)\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{\n\t\t\t\toptions.map((option, i) =>\n\t\t\t\t\t<div key={'container_'+i} className=\"components-radio-control__option\">\n\t\t\t\t\t\t<input type=\"radio\" disabled={Array.isArray(disabled) && disabled.indexOf(option.value) != -1} checked = {value==option.value} key={i} index={i} onChange={ ( e ) => onChangeHandler(option.value) } />\n\t\t\t\t\t\t<label key={'label_'+i} htmlFor={option.value} index={i}>{option.label}</label>\n\t\t\t\t\t</div>\n\t\t\t\t)\n\t\t\t}\n\t\t\t{ value==='custom' && !pagesListLoaded &&\n\t\t\t\t<div className=\"cmplz-documents-loader\">\n\t\t\t\t\t<div><Icon name = \"loading\" color = 'grey' /></div><div>{__(\"Loading...\", \"complianz-gdpr\")}</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t\t{ value==='custom' && pagesListLoaded &&\n\t\t\t\t<>\n\t                  <AsyncSelect\n\t\t\t\t\t\t  label={ __(\"Link to custom page\", \"complianz-gdpr\") }\n                          defaultOptions={pages}\n                          loadOptions={promisePages}\n\t\t\t\t\t\t  menuPortalTarget={document.body}\n\t\t\t\t\t\t  menuPosition={'fixed'}\n\t\t\t\t\t\t  placeholder={__(\"Type at least two characters\")}\n\t\t\t\t\t\t  onChange={ ( fieldValue ) => onChangeSelectHandler(fieldValue) }\n\t\t\t\t\t\t  value= { pageId }\n                        />\n\n\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{ value==='url' && !pageUrlLoaded &&\n\t\t\t\t<div className=\"cmplz-documents-loader\">\n\t\t\t\t\t<div><Icon name = \"loading\" color = 'grey' /></div><div>{__(\"Loading...\", \"complianz-gdpr\")}</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t\t{ value==='url' && pageUrlLoaded &&\n\t\t\t\t<><input type=\"text\" value={pageUrl} onChange={onChangeUrlHandler} placeholder=\"https://domain.com/your-policy\"/></>\n\t\t\t}\n\t\t</>\n\t);\n}\nexport default memo(DocumentControl);\n"],"names":["AsyncSelect","__","cmplz_api","useState","useEffect","useRef","useUpdateEffect","Icon","memo","useFields","DocumentControl","_ref","id","value","options","defaultValue","disabled","pageId","setPageId","pageUrl","setPageUrl","pages","setPages","pagesListLoaded","setPagesListLoaded","pageUrlLoaded","setPageUrlLoaded","timer","setTimer","currentType","updateField","setChangedField","loadSubFields","onLoad","loadData","current","loadOptions","data","type","doAction","then","response","values","map","option","includes","search","selectedPage","filter","element","onChangeHandler","promisePages","inputValue","Promise","resolve","setTimeout","onChangeSelectHandler","onChangeUrlHandler","e","target","clearTimeout","newTimer","createElement","Fragment","i","key","className","Array","isArray","indexOf","checked","index","onChange","htmlFor","label","name","color","defaultOptions","menuPortalTarget","document","body","menuPosition","placeholder","fieldValue"],"sourceRoot":""}