{"version":3,"file":"src_Settings_RecordsOfConsent_ExportRecordsOfConsent_js.js","mappings":"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","sources":["webpack://complianz-gdpr/./src/DateRange/useDateStore.js","webpack://complianz-gdpr/./src/Settings/RecordsOfConsent/ExportRecordsOfConsent.js","webpack://complianz-gdpr/./src/Settings/RecordsOfConsent/useRecordsOfConsentData.js"],"sourcesContent":["import {create} from 'zustand';\nimport {endOfDay, format, startOfDay, subDays} from 'date-fns';\n\n// define the store\nexport const useDate = create(set => ({\n\tstartDate: format(startOfDay(subDays(new Date(), 7)), 'yyyy-MM-dd'),\n\tsetStartDate: (startDate) => set(state => ({ startDate })),\n\tendDate: format(endOfDay(subDays(new Date(), 1)), 'yyyy-MM-dd'),\n\tsetEndDate: (endDate) => set(state => ({ endDate })),\n\trange: 'last-7-days',\n\tsetRange: (range) => set(state => ({ range })),\n}));\nexport default useDate;\n","import { __ } from '@wordpress/i18n';\nimport {useState, useEffect} from \"@wordpress/element\";\nimport useRecordsOfConsentData from \"./useRecordsOfConsentData\";\nimport Icon from \"../../utils/Icon\";\nimport useDate from \"../../DateRange/useDateStore\";\nimport {memo} from \"react\";\nconst ExportRecordsOfConsent = () => {\n\tconst { noData, startExport, exportLink, fetchExportRecordsOfConsentProgress, generating, progress} = useRecordsOfConsentData();\n\tconst [DateRange, setDateRange] = useState(null);\n\tconst {startDate, endDate} = useDate();\n\tuseEffect( () => {\n\t\timport('../../DateRange/DateRange').then(({ default: DateRange }) => {\n\t\t\tsetDateRange(() => DateRange);\n\t\t});\n\t}, []);\n\n\t//check if there's an export running\n\tuseEffect ( () => {\n\t\tfetchExportRecordsOfConsentProgress(true);\n\t},[]);\n\n\tuseEffect( () => {\n\t\t//startDate, endDate\n\t\tif (progress<100 && generating ) {\n\t\t\tfetchExportRecordsOfConsentProgress(false, startDate, endDate);\n\t\t}\n\t}, [progress]);\n\treturn (\n\t\t<>\n\t\t\t<div className={'cmplz-field-button cmplz-table-header'}>\n\t\t\t\t<div className=\"cmplz-table-header-controls\">\n\t\t\t\t\t{DateRange && <DateRange />}\n\t\t\t\t\t<button disabled={generating} className=\"button button-default cmplz-field-button\" onClick={()=>startExport()} >\n\t\t\t\t\t\t{__(\"Export to CSV\",\"complianz-gdpr\")}\n\t\t\t\t\t\t{generating && <><Icon name = \"loading\" color = 'grey' />&nbsp;{progress}%</>}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{ progress>=100 && (exportLink!=='' || noData ) &&\n\t\t\t\t<div className=\"cmplz-selected-document\">\n\t\t\t\t\t{!noData && __(\"Your Records Of Consent Export has been completed.\",\"complianz-gdpr\")}\n\t\t\t\t\t{noData && __(\"Your selection does not contain any data.\",\"complianz-gdpr\")}\n\t\t\t\t\t<div className=\"cmplz-selected-document-controls\">\n\t\t\t\t\t\t{!noData && <a className=\"button button-default\" href={exportLink}>{__(\"Download\",\"complianz-gdpr\")}</a>}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t</>\n\t)\n}\nexport default memo(ExportRecordsOfConsent);\n","import {create} from 'zustand';\nimport * as cmplz_api from \"../../utils/api\";\nconst useRecordsOfConsentData = create(( set, get ) => ({\n\trecordsLoaded: false,\n\tfetching:false,\n\tgenerating:false,\n\tprogress:false,\n\trecords: [],\n\texportLink: '',\n\tdownloadUrl: '',\n\tregions: [],\n\tfields: [],\n\tnoData:false,\n\tdeleteRecords: async (ids) => {\n\t\t//get array of records to delete\n\t\tlet deleteRecords = get().records.filter(record => ids.includes(record.id));\n\t\t//remove the ids from the records array\n\t\tset((state) => ({\n\t\t\trecords: state.records.filter(record => !ids.includes(record.id)),\n\t\t}));\n\t\tlet data = {};\n\t\tdata.records = deleteRecords;\n\t\tawait cmplz_api.doAction('delete_records_of_consent', data).then((response) => {\n\t\t\treturn response;\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t},\n\tfetchData: async ( ) => {\n\t\tif (get().fetching) return;\n\t\tset({fetching:true});\n\t\tlet data = {}\n\t\tconst { records, regions, download_url} = await cmplz_api.doAction('get_records_of_consent', data).then((response) => {\n\t\t\treturn response;\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t\tset(() => ({\n\t\t\trecordsLoaded: true,\n\t\t\trecords: records,\n\t\t\tregions: regions,\n\t\t\tdownloadUrl: download_url,\n\t\t\tfetching:false,\n\t\t}));\n\t},\n\tstartExport: async () => {\n\t\tset({\n\t\t\tgenerating: true,\n\t\t\tprogress:0,\n\t\t\texportLink: '',\n\t\t})\n\t},\n\tfetchExportRecordsOfConsentProgress: async (statusOnly, startDate, endDate) => {\n\t\tstatusOnly = typeof statusOnly !== 'undefined' ? statusOnly : false;\n\t\tif (!statusOnly) {\n\t\t\tset({ generating:true });\n\t\t}\n\n\t\tlet data = {};\n\t\tdata.startDate = startDate;\n\t\tdata.endDate = endDate;\n\t\tdata.statusOnly = statusOnly;\n\t\tconst {progress, exportLink, noData} = await cmplz_api.doAction('export_records_of_consent', data).then((response) => {\n\t\t\treturn response;\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t\tlet generating = false;\n\t\tif (progress<100 ){\n\t\t\tgenerating = true;\n\t\t}\n\t\tset({progress:progress, exportLink:exportLink, generating:generating,noData:noData});\n\n\t},\n}));\n\nexport default useRecordsOfConsentData;\n"],"names":["create","endOfDay","format","startOfDay","subDays","useDate","set","startDate","Date","setStartDate","state","endDate","setEndDate","range","setRange","__","useState","useEffect","useRecordsOfConsentData","Icon","memo","ExportRecordsOfConsent","noData","startExport","exportLink","fetchExportRecordsOfConsentProgress","generating","progress","DateRange","setDateRange","then","_ref","default","createElement","Fragment","className","disabled","onClick","name","color","href","cmplz_api","get","recordsLoaded","fetching","records","downloadUrl","regions","fields","deleteRecords","ids","filter","record","includes","id","data","doAction","response","catch","error","console","fetchData","download_url","statusOnly"],"sourceRoot":""}