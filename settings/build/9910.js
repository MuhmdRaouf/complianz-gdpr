"use strict";(globalThis.webpackChunkcomplianz_gdpr=globalThis.webpackChunkcomplianz_gdpr||[]).push([[9910,161],{49910:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var a=n(69307),r=n(65736),o=n(80161);const s=(0,n(99196).memo)((()=>{const[e,t]=(0,a.useState)(""),[s,c]=(0,a.useState)({}),[l,i]=(0,a.useState)(!1),[d,p]=(0,a.useState)(!1),{records:m,downloadUrl:g,deleteRecords:u,recordsLoaded:_,fetchData:h}=(0,o.default)(),[f,z]=(0,a.useState)(""),[b,w]=(0,a.useState)([]),y=!cmplz_settings.is_premium,[C,E]=(0,a.useState)(null);(0,a.useEffect)((()=>{n.e(44).then(n.bind(n,90044)).then((e=>{let{default:t}=e;E((()=>t))}))}),[]),(0,a.useEffect)((()=>{!_&&cmplz_settings.is_premium&&h()}),[_]);const k=async()=>{let e=m.filter((e=>b.includes(e.id)&&""!==e.poc_url));w([]);const t=async()=>{if(e.length>0){const n=e.shift(),a=g+"/"+n.poc_url;z(!0);try{let e=new XMLHttpRequest;e.responseType="blob",e.open("get",a,!0),e.send(),e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let e=window.URL.createObjectURL(this.response),t=window.document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",n.filename),window.document.body.appendChild(t),t.click(),setTimeout((function(){window.URL.revokeObjectURL(e)}),6e4)}},await t()}catch(e){console.error(e),z(!1)}}};await t(),z(!1)},L={optin:(0,r.__)("Opt-in","complianz-gdpr"),optout:(0,r.__)("Opt-out","complianz-gdpr"),other:(0,r.__)("Other","complianz-gdpr")},v=t=>(t=t.sort(((e,t)=>e.file<t.file?-1:e.file>t.file?1:0))).filter((t=>t.ip.toLowerCase().includes(e.toLowerCase())||t.services.toLowerCase().includes(e.toLowerCase())||t.id.toLowerCase().includes(e.toLowerCase()))),N=[{name:(0,a.createElement)("input",{type:"checkbox",className:l?"indeterminate":"",checked:d,onChange:e=>(e=>{if(e.target.checked){p(!0);let e=s.currentPage?s.currentPage:1,t=v(m).slice(10*(e-1),10*e);w(t.map((e=>e.id)))}else p(!1),w([]);i(!1)})(e)}),selector:e=>e.selectControl},{name:(0,r.__)("User ID","complianz-gdpr"),selector:e=>e.id,sortable:!0},{name:(0,r.__)("IP Adress","complianz-gdpr"),selector:e=>e.ip,sortable:!0},{name:(0,r.__)("Region","complianz-gdpr"),selector:e=>""!==e.region?(0,a.createElement)("img",{alt:"region",width:"20px",height:"20px",src:cmplz_settings.plugin_url+"assets/images/"+e.region+".svg"}):"",sortable:!0},{name:(0,r.__)("Services","complianz-gdpr"),selector:e=>e.services,sortable:!0},{name:(0,r.__)("Consent","complianz-gdpr"),selector:e=>e.consenttype?L[e.consenttype]:"",sortable:!0},{name:(0,r.__)("Categories","complianz-gdpr"),selector:e=>(e=>{let t={do_not_track:(0,r.__)("DNT/GPC","complianz-gdpr"),no_choice:(0,r.__)("No Choice","complianz-gdpr"),no_warning:(0,r.__)("No Warning","complianz-gdpr"),functional:(0,r.__)("Functional","complianz-gdpr"),preferences:(0,r.__)("Preferences","complianz-gdpr"),statistics:(0,r.__)("Statistics","complianz-gdpr"),marketing:(0,r.__)("Marketing","complianz-gdpr")},n=[];return Object.keys(t).forEach((a=>{1===parseInt(e[a])&&n.push(t[a])})),n.join(", ")})(e),sortable:!0},{name:(0,r.__)("Date","complianz-gdpr"),selector:e=>e.time,sortable:!0}];let D=[...m];D=v(D);let P=[];return D.forEach((e=>{let t={...e};t.selectControl=(0,a.createElement)("input",{type:"checkbox",checked:b.includes(t.id),onChange:e=>((e,t)=>{let n=e.target.checked,a=[...b];n?a.includes(t)||(a.push(t),w(a)):(a=[...b.filter((e=>e!==t))],w(a));let r=s.currentPage?s.currentPage:1,o=v(m).slice(10*(r-1),10*r),c=!0,l=!1;o.forEach((e=>{a.includes(e.id)?l=!0:c=!1})),c?(p(!0),i(!1)):l?(p(!1),i(!0)):i(!1)})(e,t.id)}),P.push(t)})),(0,a.createElement)(a.Fragment,null,y&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"cmplz-settings-overlay"},(0,a.createElement)("div",{className:"cmplz-settings-overlay-message"}))),(0,a.createElement)("div",{className:"cmplz-table-header"},(0,a.createElement)("div",{className:"cmplz-table-header-controls"},(0,a.createElement)("input",{className:"cmplz-datatable-search",type:"text",placeholder:(0,r.__)("Search","complianz-gdpr"),value:e,onChange:e=>t(e.target.value)}))),b.length>0&&(0,a.createElement)("div",{className:"cmplz-selected-document"},b.length>1&&(0,r.__)("%s items selected","complianz-gdpr").replace("%s",b.length),1===b.length&&(0,r.__)("1 item selected","complianz-gdpr"),(0,a.createElement)("div",{className:"cmplz-selected-document-controls"},m.filter((e=>b.includes(e.id)&&""!==e.poc_url)).length>0&&(0,a.createElement)("button",{disabled:f,className:"button button-default cmplz-btn-reset",onClick:()=>k()},(0,r.__)("Download Proof of Consent","complianz-gdpr")),(0,a.createElement)("button",{className:"button button-default cmplz-reset-button",onClick:()=>(async e=>{w([]),await u(e)})(b)},(0,r.__)("Delete","complianz-gdpr")))),!y&&C&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(C,{columns:N,data:P,dense:!0,pagination:!0,noDataComponent:(0,a.createElement)("div",{className:"cmplz-no-documents"},(0,r.__)("No records","really-simple-ssl")),persistTableHead:!0,theme:"really-simple-plugins",customStyles:{headCells:{style:{paddingLeft:"0",paddingRight:"0"}},cells:{style:{paddingLeft:"0",paddingRight:"0"}}},paginationPerPage:10,onChangePage:e=>{c({...s,currentPage:e})},paginationState:s})))}))},80161:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var a=n(30270),r=n(48399);const o=(0,a.Ue)(((e,t)=>({recordsLoaded:!1,fetching:!1,generating:!1,progress:!1,records:[],exportLink:"",downloadUrl:"",regions:[],fields:[],noData:!1,deleteRecords:async n=>{let a=t().records.filter((e=>n.includes(e.id)));e((e=>({records:e.records.filter((e=>!n.includes(e.id)))})));let o={};o.records=a,await r.doAction("delete_records_of_consent",o).then((e=>e)).catch((e=>{console.error(e)}))},fetchData:async()=>{if(t().fetching)return;e({fetching:!0});const{records:n,regions:a,download_url:o}=await r.doAction("get_records_of_consent",{}).then((e=>e)).catch((e=>{console.error(e)}));e((()=>({recordsLoaded:!0,records:n,regions:a,downloadUrl:o,fetching:!1})))},startExport:async()=>{e({generating:!0,progress:0,exportLink:""})},fetchExportRecordsOfConsentProgress:async(t,n,a)=>{(t=void 0!==t&&t)||e({generating:!0});let o={};o.startDate=n,o.endDate=a,o.statusOnly=t;const{progress:s,exportLink:c,noData:l}=await r.doAction("export_records_of_consent",o).then((e=>e)).catch((e=>{console.error(e)}));let i=!1;s<100&&(i=!0),e({progress:s,exportLink:c,generating:i,noData:l})}})))}}]);